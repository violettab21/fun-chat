(()=>{"use strict";var e={24:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isGeneralMessage=function(e){return"object"==typeof e&&null!==e&&("id"in e&&"type"in e&&"payload"in e)},t.isUserPayloadServer=function(e){if("object"!=typeof e||null===e)return!1;if(!("user"in e))return!1;const t=e.user;return"object"==typeof t&&null!==t&&"isLogined"in t&&"login"in t&&"boolean"==typeof t.isLogined},t.isUserPayloadClient=function(e){if("object"!=typeof e||null===e)return!1;if(!("user"in e))return!1;const t=e.user;return"object"==typeof t&&null!==t&&"password"in t&&"login"in t&&"string"==typeof t.password},t.isErrorPayload=function(e){return"object"==typeof e&&null!==e&&("error"in e&&"string"==typeof e.error)},t.isUsersPayloadServer=function(e){if("object"!=typeof e||null===e)return!1;if(!("users"in e))return!1;const t=e.users;if("object"!=typeof t||null===t||!Array.isArray(t))return!1;const n=t[0];return"object"==typeof n&&null!==n&&"isLogined"in n&&"login"in n&&"boolean"==typeof n.isLogined},t.isMessagePayloadServer=function(e){if("object"!=typeof e||null===e)return!1;if(!("message"in e))return!1;const t=e.message;return"object"==typeof t&&null!==t&&"id"in t&&"from"in t&&"to"in t&&"text"in t&&"datetime"in t&&"status"in t&&"string"==typeof t.text},t.isMessagesPayloadServer=function(e){if("object"!=typeof e||null===e)return!1;if(!("messages"in e))return!1;const t=e.messages;if("object"!=typeof t||null===t||!Array.isArray(t))return!1;if(Array.isArray(t)&&0===t.length)return!0;{const e=t[0];return"object"==typeof e&&null!==e&&"id"in e&&"from"in e&&"to"in e&&"text"in e&&"datetime"in e&&"status"in e&&"string"==typeof e.id}},t.isMessages=function(e){if("object"!=typeof e||null===e||!Array.isArray(e))return!1;const t=e[0];return"object"==typeof t&&null!==t&&"id"in t&&"from"in t&&"to"in t&&"text"in t&&"datetime"in t&&"status"in t&&"string"==typeof t.id},t.isMessagePayloadServerStatus=function(e){if("object"!=typeof e||null===e)return!1;if(!("message"in e))return!1;const t=e.message;return"object"==typeof t&&null!==t&&"id"in t&&"status"in t&&"string"==typeof t.id},t.isChatState=function(e){if("object"!=typeof e||null===e)return!1;if(!("currentUser"in e)||!("activeChatWith"in e))return!1;const t=e.currentUser,n=e.activeChatWith;return"object"==typeof t&&null!==t&&"object"==typeof n&&null!==n}},183:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});const s=n.p+"fdaba3d27bc321d0775803fac6189782.svg"},289:(e,t,n)=>{n.r(t)},349:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});const s=n.p+"f888154012dd957ef78d81f54df759b4.svg"},353:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.renderChatPageContent=function(e,t,n){const s=document.querySelector(".wrapper");s&&(s.innerHTML="",s.append(function(e,t){const n=document.createElement("header");n.className="header";const s=document.createElement("p");s.className="app-name",s.textContent="Fun Chat";const o=document.createElement("ul");o.className="header-menu";const a=document.createElement("li");a.className="header-user-name";const r=e.currentUser.login;console.log("currentUserName"+e.currentUser.login),r&&(a.textContent=r);const c=document.createElement("li");c.className="chat-info-button",c.textContent="Info",c.addEventListener("click",(()=>{t.openPage("info")}));const i=document.createElement("li");return i.className="logout-button",i.textContent="Logout",i.addEventListener("click",(()=>{const t=function(e){const t=e.currentUser.login,n=e.currentUser.password;let s="",o="";t&&n&&(s=t,o=n);return{id:crypto.randomUUID(),type:"USER_LOGOUT",payload:{user:{login:s,password:o}}}}(e);e.sendUserMessage(t)})),o.append(a,c,i),n.append(s,o),n}(e,n),function(e,t){const n=document.createElement("main");n.classList.add("main","main-chat");const s=document.createElement("div");return s.className="chat-container",s.append(function(e,t){const n=document.createElement("section");n.className="section-users";const s=document.createElement("input");s.className="search-input",s.placeholder="Search",s.addEventListener("input",(()=>{e.searchUsers(s.value)}));const o=document.createElement("ul");return o.className="users",o.addEventListener("click",(n=>{console.log("hello");const s=n.target;if(s instanceof Element){const n=s.closest(".user-chat");if(n&&n instanceof HTMLElement){console.log("hello1");const s=n.dataset.name;s&&(console.log("hello2"),function(e,t,n){const s=document.querySelector(".chat-messages");s&&(s.innerHTML="");const o=n.users.find((t=>t.login===e));if(console.log(e),o){!function(){const e=document.querySelector(".chat-message-container");e&&[...e.children].forEach((e=>{(e instanceof HTMLTextAreaElement||e instanceof HTMLButtonElement)&&(e.disabled=!1)}))}(),t.activeChatWith=o,t.getHistoryMessage(o.login);const n=document.querySelector(".chat-header");if(n){const t=[...n.children];t[0].textContent=e,o.isLogined?(t[1].textContent="online",t[1].classList.add("selected-user-status-active"),t[1].classList.remove("selected-user-status-inactive")):(t[1].textContent="offline",t[1].classList.add("selected-user-status-inactive"),t[1].classList.remove("selected-user-status-active"))}}}(s,t,e))}}})),e.getAllActiveUsers(),e.getAllInactiveUsers(),n.append(s,o),n}(e,t),function(e){const t=document.createElement("section");t.className="section-chat";const n=document.createElement("div");n.className="chat-header";const s=document.createElement("p");s.className="selected-chat-user-name";const o=document.createElement("p");o.className="selected-user-status",n.append(s,o);const r=document.createElement("div");r.className="chat-messages";const i=document.createElement("p");i.className="no-user-selected-message",i.textContent="Select User to start chat",null==r||r.append(i),r.addEventListener("click",(()=>{e.getNotReadMessagesActiveChat().forEach((t=>e.sendReadNotification(t))),l(),e.activeChatWith.login&&a(e.activeChatWith.login)}));const u=document.createElement("div");u.className="chat-message-container";const d=document.createElement("textarea");d.placeholder="Type your message here...",d.className="chat-input",d.disabled=!0,d.addEventListener("keydown",(e=>{"Enter"===e.key&&e.preventDefault()}));const m=document.createElement("button");return m.className="chat-send-button",m.textContent="Send",m.disabled=!0,m.addEventListener("click",(()=>{"Send"===m.textContent&&c(d,e),e.activeChatWith.login&&a(e.activeChatWith.login)})),document.addEventListener("keydown",(t=>{"Enter"===t.key&&"Send"===m.textContent&&(c(d,e),e.activeChatWith.login&&a(e.activeChatWith.login))})),u.append(d,m),t.append(n,r,u),t}(t)),n.append(s),n}(e,t),function(){const e=document.createElement("footer");e.className="footer";const t=document.createElement("ul");t.className="footer-content";const n=document.createElement("li");n.className="school-info",n.textContent="RSS School";const s=document.createElement("img");s.className="school-icon",s.src=o.default,n.append(s);const a=document.createElement("li");a.className="author-github";const r=document.createElement("a");r.className="author-github-link",r.href="https://github.com/violettab21",r.textContent="Violetta Batsura",a.append(r);const c=document.createElement("li");return c.className="copyright",c.textContent="Fun Chat, 2025",t.append(n,a,c),e.append(t),e}()))},t.drawUsers=function(e,t){const n=[];e.forEach((e=>{const t=document.createElement("li");t.dataset.name=e.login,t.className="user-chat",t.textContent=e.login;const s=document.createElement("span");s.className="user-status",e.isLogined?s.classList.add("user-status-active"):s.classList.add("user-status-inactive"),t.prepend(s),n.push(t)}));const s=document.querySelector(".users");s&&(s.innerHTML="",s.append(...n),e.forEach((e=>{t.getHistoryMessage(e.login)})))},t.drawMessage=r,t.scrollChatToBottom=function(){const e=document.querySelector(".chat-messages");e&&(e.scrollTop=e.scrollHeight)},t.getStatus=i,t.updateUserStatusHeader=function(e){const t=document.querySelector(".chat-header");if(t){const n=[...t.children];n[0].textContent===e.login&&(e.isLogined?(n[1].textContent="online",n[1].classList.add("selected-user-status-active"),n[1].classList.remove("selected-user-status-inactive")):(n[1].textContent="offline",n[1].classList.add("selected-user-status-inactive"),n[1].classList.remove("selected-user-status-active")))}},t.drawMessageHistory=function(e,t,n){let s=!1;const o=document.querySelector(".chat-messages");if(e.length>0){const a=[];e.forEach((e=>{(e.from===n.activeChatWith.login&&e.to===t||e.from===t&&e.to===n.activeChatWith.login)&&(!1===e.status.isReaded&&!1===s&&e.to===t&&(a.push(function(){const e=document.createElement("div");e.className="new-message-separator";const t=document.createElement("div");t.className="new-message-separator-line";const n=document.createElement("p");return n.className="new-message-separator-text",n.textContent="New Messages",e.append(t,n),e}()),s=!0),a.push(r(e,t,n)))})),null==o||o.append(...a),s&&function(){const e=document.querySelector(".chat-messages"),t=document.querySelector(".new-message-separator");e&&t&&t.scrollIntoView(!0)}()}else{const e=document.querySelector(".chat-messages");if(e&&0===[...e.children].length){const e=document.createElement("p");e.className="chat-empty-message",e.textContent="Write your first message",null==o||o.append(e)}}},t.removeMessageFromChat=function(e){const t=document.querySelector(".chat-messages");if(t){const n=[...t.children].find((t=>{if(t instanceof HTMLElement)return t.dataset.id===e}));n&&n.remove()}},t.updateMessageInChat=function(e){const t=document.querySelector(".chat-messages");if(t){const n=[...t.children].find((t=>{if(t instanceof HTMLElement)return t.dataset.id===e.id}));if(n){const t=n.querySelector(".message-text");t&&e.text&&(t.textContent=e.text);const s=n.querySelector(".message-edit-state");s&&e.status.isEdited&&(s.textContent="edited")}}},t.addMessagesCount=function(e,t){const n=document.querySelector(".users");if(n){const s=[...n.children].find((e=>{if(e instanceof HTMLElement)return e.dataset.name===t}));if(s){const t=s.querySelector(".user-message-count");if(t)t.textContent=e.toString();else{const t=document.createElement("span");t.className="user-message-count",t.textContent=e.toString(),s.append(t)}}}},t.increaseMessageCount=function(e){const t=document.querySelector(".users");if(t){const n=[...t.children].find((t=>{if(t instanceof HTMLElement)return t.dataset.name===e}));if(n){const e=n.querySelector(".user-message-count");if(e){const t=Number(e.textContent);e.textContent=(t+1).toString()}else{const e=document.createElement("span");e.className="user-message-count",e.textContent="1",n.append(e)}}}},t.decreaseMessageCount=function(e){const t=document.querySelector(".users");if(t){const n=[...t.children].find((t=>{if(t instanceof HTMLElement)return t.dataset.name===e}));if(n){const e=n.querySelector(".user-message-count");if(e){const t=Number(e.textContent);1===t?e.remove():e.textContent=(t-1).toString()}}}},t.removeMessageCount=a;const o=s(n(349));function a(e){const t=document.querySelector(".users");if(t){const n=[...t.children].find((t=>{if(t instanceof HTMLElement)return t.dataset.name===e}));if(n){const e=n.querySelector(".user-message-count");e&&e.remove()}}}function r(e,t,n){!function(){const e=document.querySelector(".chat-empty-message");e&&e.remove()}();const s=document.createElement("div");s.className="message-container",s.dataset.id=e.id;const o=document.createElement("div");o.className="message-header";const a=document.createElement("p");a.className="message-sender-name";const r=e.from,c=document.createElement("p");var l;c.className="message-date",c.textContent=(l=e.datetime,new Intl.DateTimeFormat("default",{timeStyle:"short",dateStyle:"short"}).format(l)),o.append(a,c);const u=document.createElement("div");u.className="message-container";const d=document.createElement("p");d.className="message-text",d.textContent=e.text,u.append(d);const m=document.createElement("div");m.className="message-footer";const h=document.createElement("p");h.className="message-status";const g=document.createElement("p");return g.className="message-edit-state",g.textContent=e.status.isEdited?"edited":"",m.append(g,h),r&&(r===t?(a.textContent="You",s.classList.add("chat-current-user-message"),h.textContent=i(e.status)):a.textContent=r),s.addEventListener("contextmenu",(s=>{r===t&&(s.preventDefault(),function(e,t,n,s,o){var a;!function(){var e;null===(e=document.querySelector(".chat-context-menu"))||void 0===e||e.remove()}();const r=document.createElement("div");r.dataset.messageId=n,r.className="chat-context-menu";const c=document.createElement("ul");c.className="chat-context-menu-list";const i=document.createElement("li");i.className="edit-message-option",i.textContent="Edit",i.addEventListener("click",(()=>{!function(e,t,n){var s,o;const a=document.querySelector(".chat-input"),r=document.createElement("button");null===(s=document.querySelector(".save-update"))||void 0===s||s.remove(),r.className="save-update",r.textContent="Save",null===(o=document.querySelector(".chat-message-container"))||void 0===o||o.append(r),a&&a instanceof HTMLTextAreaElement&&(a.value=t,r.addEventListener("click",(()=>{n.sendMessageUpdateNotification(e,a.value),a.value="",r.remove()})))}(n,o,s),r.remove()}));const l=document.createElement("li");l.className="delete-message-option",l.textContent="Delete",l.addEventListener("click",(()=>{s.sendMessageDeleteNotification(n),r.remove()})),c.append(i,l),r.append(c),null===(a=document.querySelector(".chat-messages"))||void 0===a||a.append(r),r.style.top=t+"px",r.style.left=e+"px",r.addEventListener("mouseout",(e=>{if(e.relatedTarget instanceof Element&&e.target instanceof Element){if(e.relatedTarget.closest(".chat-context-menu"))return;!e.relatedTarget.closest(".chat-context-menu")&&e.target.closest(".chat-context-menu")&&r.remove()}})),document.addEventListener("click",(e=>{e.target instanceof Element&&!e.target.closest(".chat-context-menu")&&r.remove()}))}(s.clientX,s.clientY,e.id,n,e.text))})),s.append(o,u,m),s}function c(e,t){if(console.log(e.value),""===e.value)return;const n=crypto.randomUUID(),s=e.value,o=t.activeChatWith.login;if(o){const e={id:n,type:"MSG_SEND",payload:{message:{to:o,text:s}}};t.sendChatMessage(e)}e.value="",t.getNotReadMessagesActiveChat().forEach((e=>t.sendReadNotification(e))),l()}function i(e){let t="";return t=(null==e?void 0:e.isReaded)?"read":(null==e?void 0:e.isDelivered)?"delivered":"sent",t}function l(){if(document.querySelector(".chat-messages")){const e=document.querySelector(".new-message-separator");e&&e.remove()}}},439:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderInfoContent=function(){const e=document.querySelector(".wrapper");if(e){e.innerHTML="";const t=document.createElement("main");t.classList.add("main","main-info");const n=document.createElement("section");n.classList.add("info-section");const s=document.createElement("h2");s.classList.add("application-info-title"),s.textContent="Fun Chat";const o=document.createElement("p");o.classList.add("application-info"),o.textContent="What could be better than chatting with your friends using a chat app?";const a=document.createElement("p");a.classList.add("application-info-details"),a.textContent="Application has been developed in scope of RSSchool JS/FE 2024Q4 to gain skills with the WebSocket connection protocol.";const r=document.createElement("a");r.classList.add("application-info-author"),r.textContent="Author Viyaleta Batsura",r.href="https://github.com/violettab21";const c=document.createElement("button");c.classList.add("info-back"),c.textContent="Back",c.addEventListener("click",(()=>history.back())),n.append(s,o,a,r,c),t.append(n),e.append(t)}}},469:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChatService=void 0;const s=n(24),o=n(353);t.ChatService=class{constructor(e,t,n){this.connection=e,this.router=t,this.activeChatWith={},this.activeChatMessages=[],this.userService=n,this.processChatMessages()}processChatMessages(){this.connection.addHandlerPerEvent("message",(e=>{if(e instanceof MessageEvent){const t=e.data;let n;if("string"==typeof t&&(n=JSON.parse(t)),(0,s.isGeneralMessage)(n))switch(n.type){case"MSG_SEND":(0,s.isMessagePayloadServer)(n.payload)&&this.userService.currentUser.login&&this.handleMessageSend(n.payload,this.userService.currentUser.login);break;case"MSG_FROM_USER":(0,s.isMessagesPayloadServer)(n.payload)&&this.userService.currentUser.login&&this.handleHistory(n.payload,this.userService.currentUser.login);break;case"MSG_DELIVER":(0,s.isMessagePayloadServerStatus)(n.payload)&&function(e){const t=e.message,n=document.querySelector(".chat-messages");if(n){const e=[...n.children].find((e=>{if(e instanceof HTMLElement)return e.dataset.id===t.id}));if(e){const n=e.querySelector(".message-status");n&&(n.textContent=(0,o.getStatus)(t.status))}}}(n.payload);break;case"MSG_READ":(0,s.isMessagePayloadServerStatus)(n.payload)&&this.updateMessages(n.payload);break;case"MSG_DELETE":(0,s.isMessagePayloadServerStatus)(n.payload)&&this.handleMessageDelete(n.payload);break;case"MSG_EDIT":(0,s.isMessagePayloadServerStatus)(n.payload)&&this.handleMessageEdit(n.payload)}}}))}sendChatMessage(e){this.connection.connection&&this.connection.connection.send(JSON.stringify(e))}getHistoryMessage(e){const t={id:crypto.randomUUID(),type:"MSG_FROM_USER",payload:{user:{login:e}}};this.connection.connection&&this.connection.connection.send(JSON.stringify(t))}handleMessageSend(e,t){var n;e.message.from===this.activeChatWith.login&&e.message.to===t||e.message.from===t&&e.message.to===this.activeChatWith.login?(null===(n=document.querySelector(".chat-messages"))||void 0===n||n.append((0,o.drawMessage)(e.message,t,this)),document.querySelector(".new-message-separator")||(0,o.scrollChatToBottom)(),this.activeChatMessages.push(e.message)):e.message.to===t&&(0,o.increaseMessageCount)(e.message.from)}handleHistory(e,t){const n=e.messages;this.activeChatWith.login&&(this.activeChatMessages=[],n.forEach((e=>this.activeChatMessages.push(e))),(0,o.drawMessageHistory)(n,t,this));const s=n.filter((e=>e.to===t&&!1===e.status.isReaded));if(s.length>0)(0,o.addMessagesCount)(s.length,s[0].from),console.log(s[0].from,s.length);else if(0===s.length){const e=n.find((e=>e.to===t&&!0===e.status.isReaded));e&&(0,o.removeMessageCount)(e.from)}}getNotReadMessagesActiveChat(){return this.activeChatMessages.filter((e=>e.from===this.activeChatWith.login&&!1===e.status.isReaded))}sendReadNotification(e){const t={id:crypto.randomUUID(),type:"MSG_READ",payload:{message:{id:e.id}}};this.connection.connection&&this.connection.connection.send(JSON.stringify(t))}updateMessages(e){this.activeChatMessages.forEach((t=>{t.id===e.message.id&&(t.status.isReaded=e.message.status.isReaded)}));const t=document.querySelector(".chat-messages");if(t){const n=[...t.children].find((t=>{if(t instanceof HTMLElement)return t.dataset.id===e.message.id&&t.classList.contains("chat-current-user-message")}));if(n){const t=n.querySelector(".message-status");t&&(t.textContent=(0,o.getStatus)(e.message.status))}}}sendMessageDeleteNotification(e){const t={id:crypto.randomUUID(),type:"MSG_DELETE",payload:{message:{id:e}}};this.connection.connection&&this.connection.connection.send(JSON.stringify(t))}sendMessageUpdateNotification(e,t){const n={id:crypto.randomUUID(),type:"MSG_EDIT",payload:{message:{id:e,text:t}}};this.connection.connection&&this.connection.connection.send(JSON.stringify(n))}handleMessageDelete(e){const t=this.activeChatMessages.findIndex((t=>t.id===e.message.id));this.activeChatMessages.splice(t,1),(0,o.removeMessageFromChat)(e.message.id),this.router.userService.users.filter((e=>e.login!==this.router.userService.currentUser.login)).forEach((e=>{e.login!==this.activeChatWith.login&&this.getHistoryMessage(e.login)}))}handleMessageEdit(e){const t=e.message.text;t&&(this.activeChatMessages.forEach((n=>{n.id===e.message.id&&(n.status.isEdited=e.message.status.isEdited,n.text=t)})),(0,o.updateMessageInChat)(e.message))}}},546:(e,t)=>{function n(){const e=document.querySelector(".login-button");e instanceof HTMLButtonElement&&(e.disabled=!0)}function s(){const e=document.querySelector(".login-button");e instanceof HTMLButtonElement&&(e.disabled=!1)}Object.defineProperty(t,"__esModule",{value:!0}),t.renderLoginContent=function(e,t,o){const a=document.querySelector(".wrapper");a&&(a.innerHTML="",a.append(function(e,t,o){const a=document.createElement("main");a.className="main",a.classList.add("main-login");const r=document.createElement("form");r.className="auth-form";const c=function(){const e=document.createElement("div");e.className="user-name-row";const t=document.createElement("label");t.className="user-name-label",t.textContent="User Name";const o=document.createElement("input");o.className="user-name-input";const a=document.createElement("p");return a.className="user-name-error",o instanceof HTMLInputElement&&(o.required=!0,o.minLength=2,o.maxLength=10,o.addEventListener("input",(()=>{!function(e,t){!1===e.validity.valid?(e.validity.valueMissing?t.textContent="User Name is required":e.validity.tooShort?t.textContent="User Name should have at least 2 characters":e.validity.tooLong&&(t.textContent="User Name should have 10 characters max"),n()):(t.textContent="",s())}(o,a)}))),e.append(t,o,a),e}(),i=function(){const e=document.createElement("div");e.className="password-row";const t=document.createElement("label");t.className="password-label",t.textContent="Password";const o=document.createElement("input");o.className="password-input";const a=document.createElement("p");return a.className="password-error",o instanceof HTMLInputElement&&(o.required=!0,o.minLength=6,o.maxLength=10,o.pattern="[a-zA-Z0-9]{6,10}",o.addEventListener("input",(()=>{!function(e,t){!1===e.validity.valid?(e.validity.valueMissing?t.textContent="Password is required":e.validity.tooShort?t.textContent="Password should have at least 6 characters":e.validity.tooLong?t.textContent="Password should have 10 characters max":e.validity.patternMismatch&&(t.textContent="Password can contain low letters, capital Letters and numbers"),n()):(t.textContent="",s())}(o,a)}))),e.append(t,o,a),e}(),l=document.createElement("button");l.className="login-button",l.textContent="Login",l.addEventListener("click",(n=>{null==n||n.preventDefault();const s=function(e,t){const n=document.querySelector(".user-name-input"),s=n instanceof HTMLInputElement?n.value:"",o=document.querySelector(".password-input"),a=o instanceof HTMLInputElement?o.value:"";e.userIdRequest=crypto.randomUUID();const r={id:e.userIdRequest,type:"USER_LOGIN",payload:{user:{login:s,password:a}}};return t.currentUser={login:s,password:a},r}(e,t);t.sendUserMessage(s)}));const u=document.createElement("button");return u.className="login-info-button",u.textContent="Info",u.addEventListener("click",(e=>{null==e||e.preventDefault(),o.openPage("info")})),r.append(c,i,l,u),a.append(r),a}(e,t,o)));const r=document.querySelector(".user-name-input"),c=document.querySelector(".password-input");r instanceof HTMLInputElement&&c instanceof HTMLInputElement&&(!1===r.validity.valid||!1===c.validity.valid?n():s())}},656:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Router=void 0;const s=n(546),o=n(900),a=n(353),r=n(439),c=n(469);t.Router=class{constructor(e,t){this.connection=e,this.currentUrl="",this.userService=new o.UserService(e,this,t),this.chatService=new c.ChatService(e,this,this.userService),this.routes=this.setRoutes(this.userService)}openPage(e){var t;void 0!==e&&history.pushState(null,"",e),this.currentUrl=globalThis.location.pathname.slice(1),console.log(this.currentUrl),""===this.currentUrl&&history.pushState(null,"","login"),null===(t=this.routes.find((e=>e.url===this.currentUrl)))||void 0===t||t.handler()}setRoutes(e){return[{url:"login",handler:()=>{e.getAllActiveUsers(),e.getAllInactiveUsers(),console.log(e.users);const t=e.users.find((t=>t.login===e.currentUser.login));t&&t.isLogined?(a.renderChatPageContent.call(null,e,this.chatService,this),history.replaceState(null,"","/chat")):s.renderLoginContent.call(null,this.connection,e,this)}},{url:"chat",handler:()=>{e.getAllActiveUsers(),e.getAllInactiveUsers(),console.log(e.users);const t=e.users.find((t=>t.login===e.currentUser.login));t&&t.isLogined?a.renderChatPageContent.call(null,e,this.chatService,this):(s.renderLoginContent.call(null,this.connection,e,this),history.replaceState(null,"","/login"))}},{url:"info",handler:r.renderInfoContent},{url:"",handler:()=>{e.getAllActiveUsers(),e.getAllInactiveUsers();const t=e.users.find((t=>t.login===e.currentUser.login));t&&t.isLogined?(a.renderChatPageContent.call(null,e,this.chatService,this),history.replaceState(null,"","/chat")):s.renderLoginContent.call(null,this.connection,e,this)}}]}}},695:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0;const s=n(722);t.State=class{constructor(){this.chatState=new s.SessionStorage("chat_state")}saveChatState(e){this.chatState.saveData(e)}getChatState(){return this.chatState.getData()}}},722:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SessionStorage=void 0,t.SessionStorage=class{constructor(e){this.key=e}saveData(e){sessionStorage.setItem(this.key,JSON.stringify(e))}getData(){const e=sessionStorage.getItem(this.key);return null===e?null:JSON.parse(e)}}},820:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createErrorMessage=function(e){const t=document.createElement("div");t.className="dark-view";const n=document.createElement("div");n.className="modal";const s=document.createElement("span");s.className="icon-close",s.addEventListener("click",(()=>{a()}));const r=new Image;r.src=o.default;const c=document.createElement("p");c.textContent=e,c.className="modal-text",s.append(r),t.append(n),n.append(s,c),document.body.append(t),document.addEventListener("keydown",(e=>{"Escape"==e.code&&a()}))};const o=s(n(183));function a(){const e=document.querySelector(".dark-view");e&&e.remove()}},849:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0,t.Connection=class{constructor(){this.userIdRequest=null,this.url="ws://localhost:4000",this.connection=null,this.listeners={}}connect(){this.connection=new WebSocket(this.url),this.connection.addEventListener("open",(e=>{this.listeners.open.forEach((t=>t(e)))})),this.connection.addEventListener("close",(e=>{this.listeners.close.forEach((t=>t(e)))})),this.connection.addEventListener("message",(e=>{this.listeners.message.forEach((t=>t(e)))}))}addHandlerPerEvent(e,t){e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t]}}},900:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserService=void 0;const s=n(820),o=n(24),a=n(353);t.UserService=class{constructor(e,t,n){this.connection=e,this.router=t,this.currentUser={},this.state=n;const s=n.getChatState();if("object"==typeof s&&null!==s&&"currentUser"in s){const e=s.currentUser;"object"==typeof e&&null!==e&&(this.currentUser=e)}this.users=[],this.processUserMessages()}processUserMessages(){this.connection.addHandlerPerEvent("message",(e=>{if(e instanceof MessageEvent){const t=e.data;let n;if("string"==typeof t&&(n=JSON.parse(t)),(0,o.isGeneralMessage)(n))switch(n.type){case"USER_LOGIN":(0,o.isUserPayloadServer)(n.payload)&&this.handleUserLoginMessage(n.payload);break;case"USER_LOGOUT":(0,o.isUserPayloadServer)(n.payload)&&this.handleUserLogoutMessage(n.payload);break;case"USER_ACTIVE":case"USER_INACTIVE":(0,o.isUsersPayloadServer)(n.payload)&&this.handleRegisteredUsersMessage(n.payload);break;case"USER_EXTERNAL_LOGIN":(0,o.isUserPayloadServer)(n.payload)&&this.handleExternalLogin(n.payload);break;case"USER_EXTERNAL_LOGOUT":(0,o.isUserPayloadServer)(n.payload)&&this.handleExternalLogout(n.payload);break;case"ERROR":if((0,o.isErrorPayload)(n.payload)){const e=n.payload;(0,s.createErrorMessage)(e.error);break}}}}))}handleUserLoginMessage(e){var t;if(e.user.login===(null===(t=this.currentUser)||void 0===t?void 0:t.login)&&e.user.isLogined){if(this.users.some((t=>t.login===e.user.login))){const t=this.users.findIndex((t=>t.login===e.user.login));this.users[t].isLogined=e.user.isLogined}else this.users.push(e.user);"login"===globalThis.location.pathname.slice(1)&&this.router.openPage("chat"),this.state.saveChatState({currentUser:this.currentUser})}}handleUserLogoutMessage(e){var t;if(e.user.login!==(null===(t=this.currentUser)||void 0===t?void 0:t.login)||e.user.isLogined)console.log("other user logged in");else{if(this.currentUser={},this.router.chatService.activeChatWith={},this.state.saveChatState({currentUser:this.currentUser}),this.users.some((e=>e.login===this.currentUser.login))){const e=this.users.findIndex((e=>e.login===this.currentUser.login));this.users.splice(e,1)}this.router.openPage("login")}}handleRegisteredUsersMessage(e){e.users.forEach((e=>{if(this.users.some((t=>t.login===e.login))){const t=this.users.findIndex((t=>t.login===e.login));this.users[t].isLogined=e.isLogined}else this.users.push(e)})),(0,a.drawUsers)(this.users.filter((e=>e.login!==this.currentUser.login)),this.router.chatService)}sendUserMessage(e){this.connection.connection&&this.connection.connection.send(JSON.stringify(e))}getAllActiveUsers(){const e={id:crypto.randomUUID(),type:"USER_ACTIVE",payload:null};this.connection.connection&&this.connection.connection.send(JSON.stringify(e))}getAllInactiveUsers(){const e={id:crypto.randomUUID(),type:"USER_INACTIVE",payload:null};this.connection.connection&&this.connection.connection.send(JSON.stringify(e))}handleExternalLogin(e){const t=document.querySelector(".users"),n=document.createElement("li");n.textContent=e.user.login,n.className="user-chat",n.dataset.name=e.user.login;const s=document.createElement("span");if(s.className="user-status",e.user.isLogined?s.classList.add("user-status-active"):s.classList.add("user-status-inactive"),n.prepend(s),this.users.some((t=>t.login===e.user.login))){const t=this.users.find((t=>t.login===e.user.login));t&&(t.isLogined=!0);const n=document.querySelector(".users");if(n){const t=[...n.children].find((t=>t.textContent===e.user.login));if(t){const e=t.querySelector(".user-status");e&&(e.classList.remove("user-status-inactive"),e.classList.add("user-status-active"))}(0,a.updateUserStatusHeader)(e.user)}}else this.users.push(e.user),t&&t.append(n)}handleExternalLogout(e){const t=this.users.find((t=>t.login===e.user.login));t&&(t.isLogined=!1);const n=document.querySelector(".users");if(n){const t=[...n.children].find((t=>{if(t instanceof HTMLElement)return t.dataset.name===e.user.login}));if(t){const e=t.querySelector(".user-status");e&&(e.classList.remove("user-status-active"),e.classList.add("user-status-inactive"))}}(0,a.updateUserStatusHeader)(e.user)}searchUsers(e){const t=this.users.filter((e=>e.login!==this.currentUser.login)).filter((t=>t.login.includes(e)));(0,a.drawUsers)(t,this.router.chatService)}}},938:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createBaseContainer=function(){const e=document.createElement("div");e.className="wrapper",document.body.append(e)}}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,n),a.exports}n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");if(s.length)for(var o=s.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=s[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{const e=n(849);n(289);const t=n(938),s=n(695),o=n(656),a=n(820),r=new e.Connection;(0,t.createBaseContainer)();const c=new s.State,i=new o.Router(r,c);console.log(r.listeners.open),r.addHandlerPerEvent("open",(()=>{console.log(r.listeners.open);const e=document.querySelector(".reconnect-message");e&&e.remove();const t=i.userService.currentUser;i.userService.getAllActiveUsers(),i.userService.getAllInactiveUsers(),console.log(t.login);const n=i.userService.users.find((e=>e.login===i.userService.currentUser.login));if(null==n?void 0:n.isLogined)i.openPage();else{if(console.log("blaaaaaaa"),"login"in t&&t.login&&"password"in t&&t.password){const e={id:crypto.randomUUID(),type:"USER_LOGIN",payload:{user:{login:t.login,password:t.password}}};i.userService.sendUserMessage(e),i.openPage()}i.openPage()}})),r.addHandlerPerEvent("close",(()=>{var e,t;document.querySelector(".reconnect-message")?(i.userService.users=[],r.connect()):((0,a.createErrorMessage)("reconnecting..."),null===(e=document.querySelector(".icon-close"))||void 0===e||e.remove(),null===(t=document.querySelector(".dark-view"))||void 0===t||t.classList.add("reconnect-message"),r.connect())})),r.connect(),globalThis.addEventListener("popstate",(()=>{i.openPage()}))})()})();
//# sourceMappingURL=bundle.2416e667623afd44bebc.js.map