(()=>{"use strict";var e={24:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isGeneralMessage=function(e){return"object"==typeof e&&null!==e&&("id"in e&&"type"in e&&"payload"in e)},t.isUserPayloadServer=function(e){if("object"!=typeof e||null===e)return!1;if(!("user"in e))return!1;const t=e.user;return"object"==typeof t&&null!==t&&"isLogined"in t&&"login"in t&&"boolean"==typeof t.isLogined},t.isUserPayloadClient=function(e){if("object"!=typeof e||null===e)return!1;if(!("user"in e))return!1;const t=e.user;return"object"==typeof t&&null!==t&&"password"in t&&"login"in t&&"string"==typeof t.password},t.isErrorPayload=function(e){return"object"==typeof e&&null!==e&&("error"in e&&"string"==typeof e.error)},t.isUsersPayloadServer=function(e){if("object"!=typeof e||null===e)return!1;if(!("users"in e))return!1;const t=e.users;if("object"!=typeof t||null===t||!Array.isArray(t))return!1;const n=t[0];return"object"==typeof n&&null!==n&&"isLogined"in n&&"login"in n&&"boolean"==typeof n.isLogined},t.isMessagePayloadServer=function(e){if("object"!=typeof e||null===e)return!1;if(!("message"in e))return!1;const t=e.message;return"object"==typeof t&&null!==t&&"id"in t&&"from"in t&&"to"in t&&"text"in t&&"datetime"in t&&"status"in t&&"string"==typeof t.text},t.isMessagesPayloadServer=function(e){if("object"!=typeof e||null===e)return!1;if(!("messages"in e))return!1;const t=e.messages;if("object"!=typeof t||null===t||!Array.isArray(t))return!1;if(Array.isArray(t)&&0===t.length)return!0;{const e=t[0];return"object"==typeof e&&null!==e&&"id"in e&&"from"in e&&"to"in e&&"text"in e&&"datetime"in e&&"status"in e&&"string"==typeof e.id}},t.isMessages=function(e){if("object"!=typeof e||null===e||!Array.isArray(e))return!1;const t=e[0];return"object"==typeof t&&null!==t&&"id"in t&&"from"in t&&"to"in t&&"text"in t&&"datetime"in t&&"status"in t&&"string"==typeof t.id},t.isMessagePayloadServerStatus=function(e){if("object"!=typeof e||null===e)return!1;if(!("message"in e))return!1;const t=e.message;return"object"==typeof t&&null!==t&&"id"in t&&"status"in t&&"string"==typeof t.id},t.isChatState=function(e){if("object"!=typeof e||null===e)return!1;if(!("currentUser"in e)||!("activeChatWith"in e))return!1;const t=e.currentUser,n=e.activeChatWith;return"object"==typeof t&&null!==t&&"object"==typeof n&&null!==n}},183:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});const s=n.p+"b1b2343d23a73a3e78fc4fd7626ab258.svg"},289:(e,t,n)=>{n.r(t)},349:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});const s=n.p+"f888154012dd957ef78d81f54df759b4.svg"},353:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.renderChatPageContent=function(e,t,n){const s=document.querySelector(".wrapper");s&&(s.innerHTML="",s.append(function(e,t){const n=document.createElement("header");n.className="header";const s=document.createElement("p");s.className="app-name",s.textContent="Fun Chat";const a=document.createElement("ul");a.className="header-menu";const o=document.createElement("li");o.className="header-user-name";const r=e.currentUser.login;console.log("currentUserName"+e.currentUser.login),r&&(o.textContent=r);const c=document.createElement("li");c.className="chat-info-button",c.textContent="Info",c.addEventListener("click",(()=>{t.openPage("info")}));const i=document.createElement("li");return i.className="logout-button",i.textContent="Logout",i.addEventListener("click",(()=>{const t=function(e){const t=e.currentUser.login,n=e.currentUser.password;let s="",a="";t&&n&&(s=t,a=n);return{id:crypto.randomUUID(),type:"USER_LOGOUT",payload:{user:{login:s,password:a}}}}(e);e.sendUserMessage(t)})),a.append(o,c,i),n.append(s,a),n}(e,n),function(e,t){const n=document.createElement("main");n.classList.add("main","main-chat");const s=document.createElement("div");return s.className="chat-container",s.append(function(e,t){const n=document.createElement("section");n.className="section-users";const s=document.createElement("input");s.className="search-input",s.addEventListener("input",(()=>{e.searchUsers(s.value)}));const a=document.createElement("ul");return a.className="users",a.addEventListener("click",(n=>{const s=n.target;if(s instanceof Element){const n=s.closest(".user-chat");if(n){const s=n.textContent;s&&function(e,t,n){const s=document.querySelector(".chat-messages");s&&(s.innerHTML="");const a=n.users.find((t=>t.login===e));if(a){!function(){const e=document.querySelector(".chat-message-container");e&&[...e.children].forEach((e=>{(e instanceof HTMLTextAreaElement||e instanceof HTMLButtonElement)&&(e.disabled=!1)}))}(),t.activeChatWith=a,t.getHistoryMessage(a.login);const n=document.querySelector(".chat-header");if(n){const t=[...n.children];t[0].textContent=e,a.isLogined?(t[1].textContent="online",t[1].classList.add("selected-user-status-active"),t[1].classList.remove("selected-user-status-inactive")):(t[1].textContent="offline",t[1].classList.add("selected-user-status-inactive"),t[1].classList.remove("selected-user-status-active"))}}}(s,t,e)}}})),e.getAllActiveUsers(),e.getAllInactiveUsers(),n.append(s,a),n}(e,t),function(e){const t=document.createElement("section");t.className="section-chat";const n=document.createElement("div");n.className="chat-header";const s=document.createElement("p");s.className="selected-chat-user-name";const a=document.createElement("p");a.className="selected-user-status",n.append(s,a);const o=document.createElement("div");o.className="chat-messages";const c=document.createElement("p");c.className="no-user-selected-message",c.textContent="Select User to start chat",null==o||o.append(c),o.addEventListener("click",(()=>{e.getNotReadMessagesActiveChat().forEach((t=>e.sendReadNotification(t))),i()}));const l=document.createElement("div");l.className="chat-message-container";const d=document.createElement("textarea");d.className="chat-input",d.disabled=!0,d.addEventListener("keydown",(e=>{"Enter"===e.key&&e.preventDefault()}));const u=document.createElement("button");return u.className="chat-send-button",u.textContent="Send",u.disabled=!0,u.addEventListener("click",(()=>{"Send"===u.textContent&&r(d,e)})),document.addEventListener("keydown",(t=>{"Enter"===t.key&&"Send"===u.textContent&&r(d,e)})),l.append(d,u),t.append(n,o,l),t}(t)),n.append(s),n}(e,t),function(){const e=document.createElement("footer");e.className="footer";const t=document.createElement("ul");t.className="footer-content";const n=document.createElement("li");n.className="school-info",n.textContent="RSS School";const s=document.createElement("img");s.className="school-icon",s.src=a.default,n.append(s);const o=document.createElement("li");o.className="author-github";const r=document.createElement("a");r.className="author-github-link",r.href="https://github.com/violettab21",r.textContent="Violetta Batsura",o.append(r);const c=document.createElement("li");return c.className="copyright",c.textContent="Fun Chat, 2025",t.append(n,o,c),e.append(t),e}()))},t.drawUsers=function(e){const t=[];e.forEach((e=>{const n=document.createElement("li");n.className="user-chat",n.textContent=e.login;const s=document.createElement("span");s.className="user-status",e.isLogined?s.classList.add("user-status-active"):s.classList.add("user-status-inactive"),n.prepend(s),t.push(n)}));const n=document.querySelector(".users");n&&(n.innerHTML="",n.append(...t))},t.drawMessage=o,t.scrollChatToBottom=function(){const e=document.querySelector(".chat-messages");e&&(e.scrollTop=e.scrollHeight)},t.getStatus=c,t.updateUserStatusHeader=function(e){const t=document.querySelector(".chat-header");if(t){const n=[...t.children];n[0].textContent===e.login&&(e.isLogined?(n[1].textContent="online",n[1].classList.add("selected-user-status-active"),n[1].classList.remove("selected-user-status-inactive")):(n[1].textContent="offline",n[1].classList.add("selected-user-status-inactive"),n[1].classList.remove("selected-user-status-active")))}},t.drawMessageHistory=function(e,t,n){let s=!1;const a=document.querySelector(".chat-messages");if(e.length>0){const r=[];e.forEach((e=>{!1===e.status.isReaded&&!1===s&&e.to===t&&(r.push(function(){const e=document.createElement("div");e.className="new-message-separator";const t=document.createElement("div");t.className="new-message-separator-line";const n=document.createElement("p");return n.className="new-message-separator-text",n.textContent="New Messages",e.append(t,n),e}()),s=!0),r.push(o(e,t,n))})),null==a||a.append(...r),s&&function(){const e=document.querySelector(".chat-messages"),t=document.querySelector(".new-message-separator");e&&t&&t.scrollIntoView(!0)}()}else{const e=document.createElement("p");e.className="chat-empty-message",e.textContent="Write your first message",null==a||a.append(e)}},t.removeMessageFromChat=function(e){const t=document.querySelector(".chat-messages");if(t){const n=[...t.children].find((t=>{if(t instanceof HTMLElement)return t.dataset.id===e}));n&&n.remove()}},t.updateMessageInChat=function(e){const t=document.querySelector(".chat-messages");if(t){const n=[...t.children].find((t=>{if(t instanceof HTMLElement)return t.dataset.id===e.id}));if(n){const t=n.querySelector(".message-text");t&&e.text&&(t.textContent=e.text);const s=n.querySelector(".message-edit-state");s&&e.status.isEdited&&(s.textContent="edited")}}};const a=s(n(349));function o(e,t,n){!function(){const e=document.querySelector(".chat-empty-message");e&&e.remove()}();const s=document.createElement("div");s.className="message-container",s.dataset.id=e.id;const a=document.createElement("div");a.className="message-header";const o=document.createElement("p");o.className="message-sender-name";const r=e.from,i=document.createElement("p");var l;i.className="message-date",i.textContent=(l=e.datetime,new Intl.DateTimeFormat("default",{timeStyle:"short",dateStyle:"short"}).format(l)),a.append(o,i);const d=document.createElement("div");d.className="message-container";const u=document.createElement("p");u.className="message-text",u.textContent=e.text,d.append(u);const m=document.createElement("div");m.className="message-footer";const h=document.createElement("p");h.className="message-status";const p=document.createElement("p");return p.className="message-edit-state",p.textContent=e.status.isEdited?"edited":"",m.append(p,h),r&&(r===t?(o.textContent="You",s.classList.add("chat-current-user-message"),h.textContent=c(e.status)):o.textContent=r),s.addEventListener("contextmenu",(s=>{r===t&&(s.preventDefault(),function(e,t,n,s,a){var o;!function(){var e;null===(e=document.querySelector(".chat-context-menu"))||void 0===e||e.remove()}();const r=document.createElement("div");r.dataset.messageId=n,r.className="chat-context-menu";const c=document.createElement("ul");c.className="chat-context-menu-list";const i=document.createElement("li");i.className="edit-message-option",i.textContent="Edit",i.addEventListener("click",(()=>{!function(e,t,n){var s,a;const o=document.querySelector(".chat-input"),r=document.createElement("button");null===(s=document.querySelector(".save-update"))||void 0===s||s.remove(),r.className="save-update",r.textContent="Save",null===(a=document.querySelector(".chat-message-container"))||void 0===a||a.append(r),o&&o instanceof HTMLTextAreaElement&&(o.value=t,r.addEventListener("click",(()=>{n.sendMessageUpdateNotification(e,o.value),o.value="",r.remove()})))}(n,a,s),r.remove()}));const l=document.createElement("li");l.className="delete-message-option",l.textContent="Delete",l.addEventListener("click",(()=>{s.sendMessageDeleteNotification(n),r.remove()})),c.append(i,l),r.append(c),null===(o=document.querySelector(".chat-messages"))||void 0===o||o.append(r),r.style.top=t+"px",r.style.left=e+"px",r.addEventListener("mouseout",(e=>{if(e.relatedTarget instanceof Element&&e.target instanceof Element){if(e.relatedTarget.closest(".chat-context-menu"))return;!e.relatedTarget.closest(".chat-context-menu")&&e.target.closest(".chat-context-menu")&&r.remove()}})),document.addEventListener("click",(e=>{e.target instanceof Element&&!e.target.closest(".chat-context-menu")&&r.remove()}))}(s.clientX,s.clientY,e.id,n,e.text))})),s.append(a,d,m),s}function r(e,t){if(console.log(e.value),""===e.value)return;const n=crypto.randomUUID(),s=e.value,a=t.activeChatWith.login;if(a){const e={id:n,type:"MSG_SEND",payload:{message:{to:a,text:s}}};t.sendChatMessage(e)}e.value="",t.getNotReadMessagesActiveChat().forEach((e=>t.sendReadNotification(e))),i()}function c(e){let t="";return t=(null==e?void 0:e.isReaded)?"read":(null==e?void 0:e.isDelivered)?"delivered":"sent",t}function i(){if(document.querySelector(".chat-messages")){const e=document.querySelector(".new-message-separator");e&&e.remove()}}},439:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderInfoContent=function(){const e=document.querySelector(".wrapper");if(e){e.innerHTML="";const t=document.createElement("main");t.classList.add("main","main-info");const n=document.createElement("section");n.classList.add("info-section");const s=document.createElement("h2");s.classList.add("application-info-title"),s.textContent="Fun Chat";const a=document.createElement("p");a.classList.add("application-info"),a.textContent="What could be better than chatting with your friends using a chat app?";const o=document.createElement("p");o.classList.add("application-info-details"),o.textContent="Application has been developed in scope of RSSchool JS/FE 2024Q4 to gain skills with the WebSocket connection protocol.";const r=document.createElement("a");r.classList.add("application-info-author"),r.textContent="Author Viyaleta Batsura",r.href="https://github.com/violettab21";const c=document.createElement("button");c.classList.add("info-back"),c.textContent="Back",c.addEventListener("click",(()=>history.back())),n.append(s,a,o,r,c),t.append(n),e.append(t)}}},469:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChatService=void 0;const s=n(24),a=n(353);t.ChatService=class{constructor(e,t,n,s){this.connection=e,this.router=t,this.activeChatWith={};const a=s.getChatState();if("object"==typeof a&&null!==a&&"currentUser"in a&&"activeChatWith"in a){const e=a.activeChatWith;"object"==typeof e&&null!==e&&(this.activeChatWith=e)}this.activeChatMessages=[],this.users=[],this.userService=n,this.processChatMessages()}processChatMessages(){this.connection.addHandlerPerEvent("message",(e=>{if(e instanceof MessageEvent){const t=e.data;let n;if("string"==typeof t&&(n=JSON.parse(t)),(0,s.isGeneralMessage)(n))switch(n.type){case"MSG_SEND":(0,s.isMessagePayloadServer)(n.payload)&&this.userService.currentUser.login&&this.handleMessageSend(n.payload,this.userService.currentUser.login);break;case"MSG_FROM_USER":(0,s.isMessagesPayloadServer)(n.payload)&&this.userService.currentUser.login&&this.handleHistory(n.payload,this.userService.currentUser.login);break;case"MSG_DELIVER":(0,s.isMessagePayloadServerStatus)(n.payload)&&function(e){const t=e.message,n=document.querySelector(".chat-messages");if(n){const e=[...n.children].find((e=>{if(e instanceof HTMLElement)return e.dataset.id===t.id}));if(e){const n=e.querySelector(".message-status");n&&(n.textContent=(0,a.getStatus)(t.status))}}}(n.payload);break;case"MSG_READ":(0,s.isMessagePayloadServerStatus)(n.payload)&&this.updateMessages(n.payload);break;case"MSG_DELETE":(0,s.isMessagePayloadServerStatus)(n.payload)&&this.handleMessageDelete(n.payload);break;case"MSG_EDIT":(0,s.isMessagePayloadServerStatus)(n.payload)&&this.handleMessageEdit(n.payload)}}}))}sendChatMessage(e){this.connection.connection&&this.connection.connection.send(JSON.stringify(e))}getHistoryMessage(e){const t={id:crypto.randomUUID(),type:"MSG_FROM_USER",payload:{user:{login:e}}};this.connection.connection&&this.connection.connection.send(JSON.stringify(t))}handleMessageSend(e,t){var n;(e.message.from===this.activeChatWith.login&&e.message.to===t||e.message.from===t&&e.message.to===this.activeChatWith.login)&&(null===(n=document.querySelector(".chat-messages"))||void 0===n||n.append((0,a.drawMessage)(e.message,t,this)),document.querySelector(".new-message-separator")||(0,a.scrollChatToBottom)(),this.activeChatMessages.push(e.message))}handleHistory(e,t){const n=e.messages;this.activeChatMessages=[],n.forEach((e=>this.activeChatMessages.push(e))),(0,a.drawMessageHistory)(n,t,this)}getNotReadMessagesActiveChat(){return this.activeChatMessages.filter((e=>e.from===this.activeChatWith.login&&!1===e.status.isReaded))}sendReadNotification(e){const t={id:crypto.randomUUID(),type:"MSG_READ",payload:{message:{id:e.id}}};this.connection.connection&&this.connection.connection.send(JSON.stringify(t))}updateMessages(e){this.activeChatMessages.forEach((t=>{t.id===e.message.id&&(t.status.isReaded=e.message.status.isReaded)}));const t=document.querySelector(".chat-messages");if(t){const n=[...t.children].find((t=>{if(t instanceof HTMLElement)return t.dataset.id===e.message.id&&t.classList.contains("chat-current-user-message")}));if(n){const t=n.querySelector(".message-status");t&&(t.textContent=(0,a.getStatus)(e.message.status))}}}sendMessageDeleteNotification(e){const t={id:crypto.randomUUID(),type:"MSG_DELETE",payload:{message:{id:e}}};this.connection.connection&&this.connection.connection.send(JSON.stringify(t))}sendMessageUpdateNotification(e,t){const n={id:crypto.randomUUID(),type:"MSG_EDIT",payload:{message:{id:e,text:t}}};this.connection.connection&&this.connection.connection.send(JSON.stringify(n))}handleMessageDelete(e){const t=this.activeChatMessages.findIndex((t=>t.id===e.message.id));this.activeChatMessages.splice(t,1),(0,a.removeMessageFromChat)(e.message.id)}handleMessageEdit(e){const t=e.message.text;t&&(this.activeChatMessages.forEach((n=>{n.id===e.message.id&&(n.status.isEdited=e.message.status.isEdited,n.text=t)})),(0,a.updateMessageInChat)(e.message))}}},546:(e,t)=>{function n(){const e=document.querySelector(".login-button");console.log(e),e instanceof HTMLButtonElement&&(e.disabled=!0)}function s(){const e=document.querySelector(".login-button");console.log(e),e instanceof HTMLButtonElement&&(e.disabled=!1)}Object.defineProperty(t,"__esModule",{value:!0}),t.renderLoginContent=function(e,t,a){const o=document.querySelector(".wrapper");o&&(o.innerHTML="",o.append(function(e,t,a){const o=document.createElement("main");o.className="main",o.classList.add("main-login");const r=document.createElement("form");r.className="auth-form";const c=function(){const e=document.createElement("div");e.className="user-name-row";const t=document.createElement("label");t.className="user-name-label",t.textContent="User Name";const a=document.createElement("input");a.className="user-name-input";const o=document.createElement("p");return o.className="user-name-error",a instanceof HTMLInputElement&&(a.required=!0,a.minLength=2,a.maxLength=10,a.addEventListener("input",(()=>{!function(e,t){!1===e.validity.valid?(e.validity.valueMissing?t.textContent="User Name is required":e.validity.tooShort?t.textContent="User Name should have at least 2 characters":e.validity.tooLong&&(t.textContent="User Name should have 10 characters max"),n()):(t.textContent="",s())}(a,o)}))),e.append(t,a,o),e}(),i=function(){const e=document.createElement("div");e.className="password-row";const t=document.createElement("label");t.className="password-label",t.textContent="Password";const a=document.createElement("input");a.className="password-input";const o=document.createElement("p");return o.className="password-error",a instanceof HTMLInputElement&&(a.required=!0,a.minLength=6,a.maxLength=10,a.pattern="[a-zA-Z0-9]{6,10}",a.addEventListener("input",(()=>{!function(e,t){!1===e.validity.valid?(e.validity.valueMissing?t.textContent="Password is required":e.validity.tooShort?t.textContent="Password should have at least 6 characters":e.validity.tooLong?t.textContent="Password should have 10 characters max":e.validity.patternMismatch&&(t.textContent="Password can contain low letters, capital Letters and numbers"),n()):(t.textContent="",s())}(a,o)}))),e.append(t,a,o),e}(),l=document.createElement("button");l.className="login-button",l.textContent="Login",l.addEventListener("click",(n=>{null==n||n.preventDefault();const s=function(e,t){const n=document.querySelector(".user-name-input"),s=n instanceof HTMLInputElement?n.value:"",a=document.querySelector(".password-input"),o=a instanceof HTMLInputElement?a.value:"";e.userIdRequest=crypto.randomUUID();const r={id:e.userIdRequest,type:"USER_LOGIN",payload:{user:{login:s,password:o}}};return t.currentUser={login:s,password:o},r}(e,t);t.sendUserMessage(s)}));const d=document.createElement("button");return d.className="login-info-button",d.textContent="Info",d.addEventListener("click",(e=>{null==e||e.preventDefault(),a.openPage("info")})),r.append(c,i,l,d),o.append(r),o}(e,t,a)));const r=document.querySelector(".user-name-input"),c=document.querySelector(".password-input");r instanceof HTMLInputElement&&c instanceof HTMLInputElement&&(!1===r.validity.valid||!1===c.validity.valid?n():s())}},656:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Router=void 0;const s=n(546),a=n(900),o=n(353),r=n(439),c=n(469);t.Router=class{constructor(e,t){this.connection=e,this.currentUrl="",this.userService=new a.UserService(e,this,t),this.chatService=new c.ChatService(e,this,this.userService,t),this.routes=this.setRoutes(this.userService)}openPage(e){var t;void 0!==e&&history.pushState(null,"",e),this.currentUrl=globalThis.location.pathname.slice(1),""===this.currentUrl&&history.pushState(null,"","login"),null===(t=this.routes.find((e=>e.url===this.currentUrl)))||void 0===t||t.handler()}setRoutes(e){return[{url:"login",handler:s.renderLoginContent.bind(null,this.connection,e,this)},{url:"chat",handler:o.renderChatPageContent.bind(null,e,this.chatService,this)},{url:"info",handler:r.renderInfoContent},{url:"",handler:s.renderLoginContent.bind(null,this.connection,e,this)}]}}},695:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0;const s=n(722);t.State=class{constructor(){this.chatState=new s.SessionStorage("chat_state")}saveChatState(e){this.chatState.saveData(e)}getChatState(){return this.chatState.getData()}}},722:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SessionStorage=void 0,t.SessionStorage=class{constructor(e){this.key=e}saveData(e){sessionStorage.setItem(this.key,JSON.stringify(e))}getData(){const e=sessionStorage.getItem(this.key);return null===e?null:JSON.parse(e)}}},820:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createErrorMessage=function(e){const t=document.createElement("div");t.className="dark-view";const n=document.createElement("div");n.className="modal";const s=document.createElement("span");s.className="icon-close",s.addEventListener("click",(()=>{o()}));const r=new Image;r.src=a.default;const c=document.createElement("p");c.textContent=e,c.className="modal-text",s.append(r),t.append(n),n.append(s,c),document.body.append(t),document.addEventListener("keydown",(e=>{"Escape"==e.code&&o()})),function(){const e=document.querySelector(".dark-view");e&&e.addEventListener("click",(t=>{t.target===t.currentTarget&&e.remove()}))}()};const a=s(n(183));function o(){const e=document.querySelector(".dark-view");e&&e.remove()}},849:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0,t.Connection=class{constructor(){this.userIdRequest=null,this.url="ws://localhost:4000",this.connection=null,this.listeners={}}connect(){this.connection=new WebSocket(this.url),this.connection.addEventListener("open",(e=>{this.listeners.open.forEach((t=>t(e)))})),this.connection.addEventListener("close",(e=>{this.listeners.close.forEach((t=>t(e)))})),this.connection.addEventListener("error",(e=>{this.listeners.error.forEach((t=>t(e)))})),this.connection.addEventListener("message",(e=>{this.listeners.message.forEach((t=>t(e)))}))}addHandlerPerEvent(e,t){e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t]}}},900:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserService=void 0;const s=n(820),a=n(24),o=n(353);t.UserService=class{constructor(e,t,n){this.connection=e,this.router=t,this.currentUser={},this.state=n;const s=n.getChatState();if("object"==typeof s&&null!==s&&"currentUser"in s&&"activeChatWith"in s){const e=s.currentUser;"object"==typeof e&&null!==e&&(this.currentUser=e)}this.users=[],this.processUserMessages()}processUserMessages(){this.connection.addHandlerPerEvent("message",(e=>{if(e instanceof MessageEvent){const t=e.data;let n;if("string"==typeof t&&(n=JSON.parse(t)),(0,a.isGeneralMessage)(n))switch(n.type){case"USER_LOGIN":(0,a.isUserPayloadServer)(n.payload)&&this.handleUserLoginMessage(n.payload);break;case"USER_LOGOUT":(0,a.isUserPayloadServer)(n.payload)&&this.handleUserLogoutMessage(n.payload);break;case"USER_ACTIVE":case"USER_INACTIVE":(0,a.isUsersPayloadServer)(n.payload)&&this.handleRegisteredUsersMessage(n.payload);break;case"USER_EXTERNAL_LOGIN":(0,a.isUserPayloadServer)(n.payload)&&this.handleExternalLogin(n.payload);break;case"USER_EXTERNAL_LOGOUT":(0,a.isUserPayloadServer)(n.payload)&&this.handleExternalLogout(n.payload);break;case"ERROR":if((0,a.isErrorPayload)(n.payload)){const e=n.payload;(0,s.createErrorMessage)(e.error);break}}}}))}handleUserLoginMessage(e){var t;e.user.login===(null===(t=this.currentUser)||void 0===t?void 0:t.login)&&e.user.isLogined&&(this.router.openPage("chat"),this.state.saveChatState({currentUser:this.currentUser,activeChatWith:this.router.chatService.activeChatWith}))}handleUserLogoutMessage(e){var t;e.user.login!==(null===(t=this.currentUser)||void 0===t?void 0:t.login)||e.user.isLogined?console.log("other user logged in"):(this.currentUser={},this.state.saveChatState({currentUser:this.currentUser,activeChatWith:this.router.chatService.activeChatWith}),this.router.openPage("login"))}handleRegisteredUsersMessage(e){const t=e.users;if(this.users.some((e=>e.login===this.currentUser.login))){const e=this.users.findIndex((e=>e.login===this.currentUser.login));this.users.splice(e,1)}t.forEach((e=>{e.login!==this.currentUser.login&&(this.users.some((t=>t.login===e.login))||this.users.push(e))})),(0,o.drawUsers)(this.users)}sendUserMessage(e){this.connection.connection&&this.connection.connection.send(JSON.stringify(e))}getAllActiveUsers(){const e={id:crypto.randomUUID(),type:"USER_ACTIVE",payload:null};this.connection.connection&&this.connection.connection.send(JSON.stringify(e))}getAllInactiveUsers(){const e={id:crypto.randomUUID(),type:"USER_INACTIVE",payload:null};this.connection.connection&&this.connection.connection.send(JSON.stringify(e))}handleExternalLogin(e){const t=document.querySelector(".users"),n=document.createElement("li");n.textContent=e.user.login,n.className="user-chat";const s=document.createElement("span");if(s.className="user-status",e.user.isLogined?s.classList.add("user-status-active"):s.classList.add("user-status-inactive"),n.prepend(s),this.users.some((t=>t.login===e.user.login))){const t=this.users.find((t=>t.login===e.user.login));t&&(t.isLogined=!0);const n=document.querySelector(".users");if(n){const t=[...n.children].find((t=>t.textContent===e.user.login));if(t){const e=t.querySelector(".user-status");e&&(e.classList.remove("user-status-inactive"),e.classList.add("user-status-active"))}(0,o.updateUserStatusHeader)(e.user)}}else this.users.push(e.user),t&&t.append(n)}handleExternalLogout(e){const t=this.users.find((t=>t.login===e.user.login));t&&(t.isLogined=!1);const n=document.querySelector(".users");if(n){const t=[...n.children].find((t=>t.textContent===e.user.login));if(t){const e=t.querySelector(".user-status");e&&(e.classList.remove("user-status-active"),e.classList.add("user-status-inactive"))}}(0,o.updateUserStatusHeader)(e.user)}searchUsers(e){const t=this.users.filter((t=>t.login.includes(e)));(0,o.drawUsers)(t)}}},938:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createBaseContainer=function(){const e=document.createElement("div");e.className="wrapper",document.body.append(e)}}},t={};function n(s){var a=t[s];if(void 0!==a)return a.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,n),o.exports}n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");if(s.length)for(var a=s.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=s[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{const e=n(849);n(289);const t=n(938),s=n(695),a=n(656),o=n(820),r=new e.Connection;r.connect(),(0,t.createBaseContainer)();const c=new s.State,i=new a.Router(r,c);r.addHandlerPerEvent("open",(()=>{const e=document.querySelector(".reconnect-message");e&&e.remove();const t=i.userService.currentUser;if("login"in t&&t.login&&"password"in t&&t.password){const e={id:crypto.randomUUID(),type:"USER_LOGIN",payload:{user:{login:t.login,password:t.password}}};i.userService.sendUserMessage(e)}i.openPage()})),r.addHandlerPerEvent("close",(()=>{var e,t;document.querySelector(".reconnect-message")||((0,o.createErrorMessage)("reconnecting..."),null===(e=document.querySelector(".icon-close"))||void 0===e||e.remove(),null===(t=document.querySelector(".dark-view"))||void 0===t||t.classList.add("reconnect-message")),r.connect()})),r.addHandlerPerEvent("error",(()=>{var e,t;document.querySelector(".reconnect-message")||((0,o.createErrorMessage)("reconnecting..."),null===(e=document.querySelector(".icon-close"))||void 0===e||e.remove(),null===(t=document.querySelector(".dark-view"))||void 0===t||t.classList.add("reconnect-message")),r.connect()}));const l=r.connection;document.addEventListener("DOMContentLoaded",(()=>{l&&1===l.readyState&&i.openPage()})),globalThis.addEventListener("popstate",(()=>{l&&1===l.readyState&&i.openPage()}))})()})();
//# sourceMappingURL=bundle.9863791aa1f6ecd76c26.js.map