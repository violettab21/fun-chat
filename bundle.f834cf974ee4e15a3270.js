(()=>{"use strict";var e={24:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isGeneralMessage=function(e){return"object"==typeof e&&null!==e&&("id"in e&&"type"in e&&"payload"in e)},t.isUserPayloadServer=function(e){if("object"!=typeof e||null===e)return!1;if(!("user"in e))return!1;const t=e.user;return"object"==typeof t&&null!==t&&"isLogined"in t&&"login"in t&&"boolean"==typeof t.isLogined},t.isUserPayloadClient=function(e){if("object"!=typeof e||null===e)return!1;if(!("user"in e))return!1;const t=e.user;return"object"==typeof t&&null!==t&&"password"in t&&"login"in t&&"string"==typeof t.password},t.isErrorPayload=function(e){return"object"==typeof e&&null!==e&&("error"in e&&"string"==typeof e.error)},t.isUsersPayloadServer=function(e){if("object"!=typeof e||null===e)return!1;if(!("users"in e))return!1;const t=e.users;if("object"!=typeof t||null===t||!Array.isArray(t))return!1;const s=t[0];return"object"==typeof s&&null!==s&&"isLogined"in s&&"login"in s&&"boolean"==typeof s.isLogined},t.isMessagePayloadServer=function(e){if("object"!=typeof e||null===e)return!1;if(!("message"in e))return!1;const t=e.message;return"object"==typeof t&&null!==t&&"id"in t&&"from"in t&&"to"in t&&"text"in t&&"datetime"in t&&"status"in t&&"string"==typeof t.text},t.isMessagesPayloadServer=function(e){if("object"!=typeof e||null===e)return!1;if(!("messages"in e))return!1;const t=e.messages;if("object"!=typeof t||null===t||!Array.isArray(t))return!1;if(Array.isArray(t)&&0===t.length)return!0;{const e=t[0];return"object"==typeof e&&null!==e&&"id"in e&&"from"in e&&"to"in e&&"text"in e&&"datetime"in e&&"status"in e&&"string"==typeof e.id}},t.isMessages=function(e){if("object"!=typeof e||null===e||!Array.isArray(e))return!1;const t=e[0];return"object"==typeof t&&null!==t&&"id"in t&&"from"in t&&"to"in t&&"text"in t&&"datetime"in t&&"status"in t&&"string"==typeof t.id},t.isMessagePayloadServerStatus=function(e){if("object"!=typeof e||null===e)return!1;if(!("message"in e))return!1;const t=e.message;return"object"==typeof t&&null!==t&&"id"in t&&"status"in t&&"string"==typeof t.id},t.isChatState=function(e){if("object"!=typeof e||null===e)return!1;if(!("currentUser"in e)||!("activeChatWith"in e))return!1;const t=e.currentUser,s=e.activeChatWith;return"object"==typeof t&&null!==t&&"object"==typeof s&&null!==s}},183:(e,t,s)=>{s.r(t),s.d(t,{default:()=>n});const n=s.p+"fdaba3d27bc321d0775803fac6189782.svg"},209:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDate=function(e){return new Intl.DateTimeFormat("default",{timeStyle:"short",dateStyle:"short"}).format(e)},t.cancelEnterTextarea=function(e){"Enter"===e.key&&e.preventDefault()},t.getStatus=function(e){let t="";return t=(null==e?void 0:e.isReaded)?"read":(null==e?void 0:e.isDelivered)?"delivered":"sent",t}},282:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.infoButtonHandlerLogin=function(e){return t=>{null==t||t.preventDefault(),e.openPage("info")}},t.loginHandler=function(e,t){return s=>{null==s||s.preventDefault();const o=(0,n.prepareUserRequest)(e,t);t.sendUserMessage(o)}},t.validateUserName=a,t.validatePassword=o,t.disableLoginButton=r,t.enableLoginButton=i,t.passwordFieldHandler=function(e,t){return()=>{o(e,t)}},t.userNameFieldHandler=function(e,t){return()=>{a(e,t)}};const n=s(900);function o(e,t){!1===e.validity.valid?(e.validity.valueMissing?t.textContent="Password is required":e.validity.tooShort?t.textContent="Password should have at least 6 characters":e.validity.tooLong?t.textContent="Password should have 10 characters max":e.validity.patternMismatch&&(t.textContent="Password can contain low letters, capital Letters and numbers"),r()):(t.textContent="",i())}function a(e,t){!1===e.validity.valid?(e.validity.valueMissing?t.textContent="User Name is required":e.validity.tooShort?t.textContent="User Name should have at least 2 characters":e.validity.tooLong&&(t.textContent="User Name should have 10 characters max"),r()):(t.textContent="",i())}function r(){const e=document.querySelector(".login-button");e instanceof HTMLButtonElement&&(e.disabled=!0)}function i(){const e=document.querySelector(".login-button");e instanceof HTMLButtonElement&&(e.disabled=!1)}},289:(e,t,s)=>{s.r(t)},349:(e,t,s)=>{s.r(t),s.d(t,{default:()=>n});const n=s.p+"f888154012dd957ef78d81f54df759b4.svg"},353:function(e,t,s){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.renderChatPageContent=function(e,t,s){const n=document.querySelector(".wrapper");n&&(n.innerHTML="",n.append(function(e,t){const s=document.createElement("header");s.className="header";const n=document.createElement("p");n.className="app-name",n.textContent="Fun Chat";const o=document.createElement("ul");o.className="header-menu";const a=document.createElement("li");a.className="header-user-name";const i=e.currentUser.login;i&&(a.textContent=i);const c=document.createElement("li");c.className="chat-info-button",c.textContent="Info";const l=(0,r.infoButtonHandler)(t);c.addEventListener("click",l);const d=document.createElement("li");d.className="logout-button",d.textContent="Logout";const u=(0,r.logoutHandler)(e);return d.addEventListener("click",u),o.append(a,c,d),s.append(n,o),s}(e,s),function(e,t){const s=document.createElement("main");s.classList.add("main","main-chat");const n=document.createElement("div");return n.className="chat-container",n.append(function(e,t){const s=document.createElement("section");s.className="section-users";const n=document.createElement("input");n.className="search-input",n.placeholder="Search";const o=(0,r.searchUsersHandler)(n,e);n.addEventListener("input",o);const a=document.createElement("ul");a.className="users";const i=(0,r.selectChatHandler)(t,e);return a.addEventListener("click",i),e.getAllActiveUsers(),e.getAllInactiveUsers(),s.append(n,a),s}(e,t),function(e){const t=document.createElement("section");t.className="section-chat";const s=function(){const e=document.createElement("div");e.className="chat-header";const t=document.createElement("p");t.className="selected-chat-user-name";const s=document.createElement("p");return s.className="selected-user-status",e.append(t,s),e}(),n=function(e){const t=document.createElement("div");t.className="chat-messages";const s=document.createElement("p");s.className="no-user-selected-message",s.textContent="Select User to start chat",null==t||t.append(s);const n=(0,r.readMessagesHandler)(e);return t.addEventListener("click",n),t}(e),o=function(e){const t=document.createElement("div");t.className="chat-message-container";const s=document.createElement("textarea");s.placeholder="Type your message here...",s.className="chat-input",s.disabled=!0,s.addEventListener("keydown",a.cancelEnterTextarea);const n=document.createElement("button");n.className="chat-send-button",n.textContent="Send",n.disabled=!0;const o=(0,r.sendMessageHandler)(e,s);return n.addEventListener("click",o),document.addEventListener("keydown",o),t.append(s,n),t}(e);return t.append(s,n,o),t}(t)),s.append(n),s}(e,t),function(){const e=document.createElement("footer");e.className="footer";const t=document.createElement("ul");t.className="footer-content";const s=document.createElement("li");s.className="school-info",s.textContent="RSS School";const n=document.createElement("img");n.className="school-icon",n.src=o.default,s.append(n);const a=document.createElement("li");a.className="author-github";const r=document.createElement("a");r.className="author-github-link",r.href="https://github.com/violettab21",r.textContent="Violetta Batsura",a.append(r);const i=document.createElement("li");return i.className="copyright",i.textContent="Fun Chat, 2025",t.append(s,a,i),e.append(t),e}()))},t.drawUsers=function(e,t){const s=[];e.forEach((e=>{const t=document.createElement("li");t.dataset.name=e.login,t.className="user-chat",t.textContent=e.login;const n=document.createElement("span");n.className="user-status",e.isLogined?n.classList.add("user-status-active"):n.classList.add("user-status-inactive"),t.prepend(n),s.push(t)}));const n=document.querySelector(".users");n&&(n.innerHTML="",n.append(...s),e.forEach((e=>{t.getHistoryMessage(e.login)})))},t.drawMessage=i,t.drawMessageHistory=function(e,t,s){let n=!1;const o=document.querySelector(".chat-messages");if(e.length>0){const a=[];e.forEach((e=>{(e.from===s.activeChatWith.login&&e.to===t||e.from===t&&e.to===s.activeChatWith.login)&&(!1===e.status.isReaded&&!1===n&&e.to===t&&(a.push(function(){const e=document.createElement("div");e.className="new-message-separator";const t=document.createElement("div");t.className="new-message-separator-line";const s=document.createElement("p");return s.className="new-message-separator-text",s.textContent="New Messages",e.append(t,s),e}()),n=!0),a.push(i(e,t,s)))})),null==o||o.append(...a),n&&(0,r.scrollChatToSeparator)()}else!function(){const e=document.querySelector(".chat-messages");if(e&&0===[...e.children].length){const t=document.createElement("p");t.className="chat-empty-message",t.textContent="Write your first message",null==e||e.append(t)}}()},t.addMessagesCount=function(e,t){const s=document.querySelector(".users");if(s){const n=[...s.children].find((e=>{if(e instanceof HTMLElement)return e.dataset.name===t}));if(n){const t=n.querySelector(".user-message-count");if(t)t.textContent=e.toString();else{const t=document.createElement("span");t.className="user-message-count",t.textContent=e.toString(),n.append(t)}}}},t.increaseMessageCount=function(e){const t=document.querySelector(".users");if(t){const s=[...t.children].find((t=>{if(t instanceof HTMLElement)return t.dataset.name===e}));if(s){const e=s.querySelector(".user-message-count");if(e){const t=Number(e.textContent);e.textContent=(t+1).toString()}else{const e=document.createElement("span");e.className="user-message-count",e.textContent="1",s.append(e)}}}},t.removeMessageCount=function(e){const t=document.querySelector(".users");if(t){const s=[...t.children].find((t=>{if(t instanceof HTMLElement)return t.dataset.name===e}));if(s){const e=s.querySelector(".user-message-count");e&&e.remove()}}},t.removeNewMessageLine=function(){if(document.querySelector(".chat-messages")){const e=document.querySelector(".new-message-separator");e&&e.remove()}},t.showContextMenu=function(e,t,s,n,o){var a;!function(){var e;null===(e=document.querySelector(".chat-context-menu"))||void 0===e||e.remove()}();const i=document.createElement("div");i.dataset.messageId=s,i.className="chat-context-menu";const c=document.createElement("ul");c.className="chat-context-menu-list";const l=document.createElement("li");l.className="edit-message-option",l.textContent="Edit";const d=(0,r.editOptionHandler)(s,o,n,i);l.addEventListener("click",d);const u=document.createElement("li");u.className="delete-message-option",u.textContent="Delete";const m=(0,r.deleteOptionHandler)(n,s,i);u.addEventListener("click",m),c.append(l,u),i.append(c),null===(a=document.querySelector(".chat-messages"))||void 0===a||a.append(i),i.style.top=t+"px",i.style.left=e+"px",(0,r.addCloseHandlersForContextMenu)(i)},t.drawUser=function(e){const t=document.querySelector(".users"),s=document.createElement("li");s.textContent=e.login,s.className="user-chat",s.dataset.name=e.login;const n=document.createElement("span");n.className="user-status",e.isLogined?n.classList.add("user-status-active"):n.classList.add("user-status-inactive"),s.prepend(n),t&&t.append(s)};const o=n(s(349)),a=s(209),r=s(471);function i(e,t,s){!function(){const e=document.querySelector(".chat-empty-message");e&&e.remove()}();const n=document.createElement("div");n.className="message-container",n.dataset.id=e.id;const o=function(e,t){const s=document.createElement("div");s.className="message-header";const n=document.createElement("p");n.className="message-sender-name";const o=e.from,r=document.createElement("p");return r.className="message-date",r.textContent=(0,a.getDate)(e.datetime),n.textContent=o===t?"You":n.textContent=o,s.append(n,r),s}(e,t),i=document.createElement("div");i.className="message-container";const c=document.createElement("p");c.className="message-text",c.textContent=e.text,i.append(c);const l=document.createElement("div");l.className="message-footer";const d=document.createElement("p");d.className="message-status";const u=document.createElement("p");u.className="message-edit-state",u.textContent=e.status.isEdited?"edited":"",l.append(u,d),e.from===t&&(n.classList.add("chat-current-user-message"),d.textContent=(0,a.getStatus)(e.status));const m=(0,r.messageRightClickHandler)(e,t,s);return n.addEventListener("contextmenu",m),n.append(o,i,l),n}},439:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderInfoContent=function(){const e=document.querySelector(".wrapper");if(e){e.innerHTML="";const t=document.createElement("main");t.classList.add("main","main-info");const s=document.createElement("section");s.classList.add("info-section");const n=document.createElement("h2");n.classList.add("application-info-title"),n.textContent="Fun Chat";const o=document.createElement("p");o.classList.add("application-info"),o.textContent="What could be better than chatting with your friends using a chat app?";const a=document.createElement("p");a.classList.add("application-info-details"),a.textContent="Application has been developed in scope of RSSchool JS/FE 2024Q4 to gain skills with the WebSocket connection protocol.";const r=document.createElement("a");r.classList.add("application-info-author"),r.textContent="Author Viyaleta Batsura",r.href="https://github.com/violettab21";const i=document.createElement("button");i.classList.add("info-back"),i.textContent="Back",i.addEventListener("click",(()=>history.back())),s.append(n,o,a,r,i),t.append(s),e.append(t)}}},469:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChatService=void 0;const n=s(24),o=s(353),a=s(209),r=s(613),i=s(471);t.ChatService=class{constructor(e,t,s){this.connection=e,this.router=t,this.activeChatWith={},this.activeChatMessages=[],this.userService=s,this.processChatMessages()}processChatMessages(){this.connection.addHandlerPerEvent("message",(e=>{if(e instanceof MessageEvent){const t=e.data;let s;"string"==typeof t&&(s=JSON.parse(t)),(0,n.isGeneralMessage)(s)&&(this.sendMessageHandler(s),this.messageHistoryHandler(s),function(e){e.type===r.ResponseTypesChat.MSG_DELIVER&&(0,n.isMessagePayloadServerStatus)(e.payload)&&function(e){const t=e.message,s=document.querySelector(".chat-messages");if(s){const e=[...s.children].find((e=>{if(e instanceof HTMLElement)return e.dataset.id===t.id}));if(e){const s=e.querySelector(".message-status");s&&(s.textContent=(0,a.getStatus)(t.status))}}}(e.payload)}(s),this.readMessageHandler(s),this.deleteMessageHandler(s),this.editMessageHandler(s))}}))}sendMessageHandler(e){e.type===r.ResponseTypesChat.MSG_SEND&&(0,n.isMessagePayloadServer)(e.payload)&&this.userService.currentUser.login&&this.handleMessageSend(e.payload,this.userService.currentUser.login)}messageHistoryHandler(e){e.type===r.ResponseTypesChat.MSG_FROM_USER&&(0,n.isMessagesPayloadServer)(e.payload)&&this.userService.currentUser.login&&this.handleHistory(e.payload,this.userService.currentUser.login)}readMessageHandler(e){e.type===r.ResponseTypesChat.MSG_READ&&(0,n.isMessagePayloadServerStatus)(e.payload)&&this.updateMessages(e.payload)}deleteMessageHandler(e){e.type===r.ResponseTypesChat.MSG_DELETE&&(0,n.isMessagePayloadServerStatus)(e.payload)&&this.handleMessageDelete(e.payload)}editMessageHandler(e){e.type===r.ResponseTypesChat.MSG_EDIT&&(0,n.isMessagePayloadServerStatus)(e.payload)&&this.handleMessageEdit(e.payload)}sendChatMessage(e){this.connection.connection&&this.connection.connection.send(JSON.stringify(e))}getHistoryMessage(e){const t={id:crypto.randomUUID(),type:r.ResponseTypesChat.MSG_FROM_USER,payload:{user:{login:e}}};this.connection.connection&&this.connection.connection.send(JSON.stringify(t))}handleMessageSend(e,t){var s;e.message.from===this.activeChatWith.login&&e.message.to===t||e.message.from===t&&e.message.to===this.activeChatWith.login?(null===(s=document.querySelector(".chat-messages"))||void 0===s||s.append((0,o.drawMessage)(e.message,t,this)),document.querySelector(".new-message-separator")||(0,i.scrollChatToBottom)(),this.activeChatMessages.push(e.message)):e.message.to===t&&(0,o.increaseMessageCount)(e.message.from)}handleHistory(e,t){const s=e.messages;this.activeChatWith.login&&(this.activeChatMessages=[],s.forEach((e=>this.activeChatMessages.push(e))),(0,o.drawMessageHistory)(s,t,this));const n=s.filter((e=>e.to===t&&!1===e.status.isReaded));if(n.length>0)(0,o.addMessagesCount)(n.length,n[0].from);else if(0===n.length){const e=s.find((e=>e.to===t&&!0===e.status.isReaded));e&&(0,o.removeMessageCount)(e.from)}}getNotReadMessagesActiveChat(){return this.activeChatMessages.filter((e=>e.from===this.activeChatWith.login&&!1===e.status.isReaded))}sendReadNotification(e){const t={id:crypto.randomUUID(),type:r.ResponseTypesChat.MSG_READ,payload:{message:{id:e.id}}};this.connection.connection&&this.connection.connection.send(JSON.stringify(t))}updateMessages(e){this.activeChatMessages.forEach((t=>{t.id===e.message.id&&(t.status.isReaded=e.message.status.isReaded)}));const t=document.querySelector(".chat-messages");if(t){const s=[...t.children].find((t=>{if(t instanceof HTMLElement)return t.dataset.id===e.message.id&&t.classList.contains("chat-current-user-message")}));if(s){const t=s.querySelector(".message-status");t&&(t.textContent=(0,a.getStatus)(e.message.status))}}}sendMessageDeleteNotification(e){const t={id:crypto.randomUUID(),type:r.ResponseTypesChat.MSG_DELETE,payload:{message:{id:e}}};this.connection.connection&&this.connection.connection.send(JSON.stringify(t))}sendMessageUpdateNotification(e,t){const s={id:crypto.randomUUID(),type:r.ResponseTypesChat.MSG_EDIT,payload:{message:{id:e,text:t}}};this.connection.connection&&this.connection.connection.send(JSON.stringify(s))}handleMessageDelete(e){const t=this.activeChatMessages.findIndex((t=>t.id===e.message.id));this.activeChatMessages.splice(t,1),(0,i.removeMessageFromChat)(e.message.id),this.router.userService.users.filter((e=>e.login!==this.router.userService.currentUser.login)).forEach((e=>{e.login!==this.activeChatWith.login&&this.getHistoryMessage(e.login)}))}handleMessageEdit(e){const t=e.message.text;t&&(this.activeChatMessages.forEach((s=>{s.id===e.message.id&&(s.status.isEdited=e.message.status.isEdited,s.text=t)})),(0,i.updateMessageInChat)(e.message))}sendMessageRequest(e){const t=crypto.randomUUID(),s=e,n=this.activeChatWith.login;if(n){const e={id:t,type:r.ResponseTypesChat.MSG_SEND,payload:{message:{to:n,text:s}}};this.sendChatMessage(e)}}}},471:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sendMessageHandler=function(e,t){return s=>{const n=document.querySelector(".chat-send-button");(s instanceof Event&&s.target instanceof HTMLElement&&"Send"===s.target.textContent||s instanceof KeyboardEvent&&n&&"Enter"===s.key&&"Send"===n.textContent)&&function(e,t){""!==e.value&&(t.sendMessageRequest(e.value),e.value="",t.getNotReadMessagesActiveChat().forEach((e=>t.sendReadNotification(e))),(0,r.removeNewMessageLine)())}(t,e),e.activeChatWith.login&&(0,a.removeMessageCount)(e.activeChatWith.login)}},t.readMessagesHandler=function(e){return()=>{e.getNotReadMessagesActiveChat().forEach((t=>e.sendReadNotification(t))),(0,r.removeNewMessageLine)(),e.activeChatWith.login&&(0,a.removeMessageCount)(e.activeChatWith.login)}},t.searchUsersHandler=function(e,t){return()=>{t.searchUsers(e.value)}},t.selectChatHandler=function(e,t){return s=>{const n=s.target;if(n instanceof Element){const s=n.closest(".user-chat");if(s&&s instanceof HTMLElement){const n=s.dataset.name;n&&function(e,t,s){const n=document.querySelector(".chat-messages");n&&(n.innerHTML="");const o=s.users.find((t=>t.login===e));if(o){!function(){const e=document.querySelector(".chat-message-container");e&&[...e.children].forEach((e=>{(e instanceof HTMLTextAreaElement||e instanceof HTMLButtonElement)&&(e.disabled=!1)}))}(),t.activeChatWith=o,t.getHistoryMessage(o.login);const s=document.querySelector(".chat-header");s&&([...s.children][0].textContent=e),i(o)}}(n,e,t)}}}},t.infoButtonHandler=function(e){return()=>{e.openPage("info")}},t.logoutHandler=function(e){return()=>{const t=(0,o.prepareUserLogoutRequest)(e);e.sendUserMessage(t)}},t.updateUserStatusHeader=i,t.messageRightClickHandler=function(e,t,s){return o=>{e.from===t&&(o.preventDefault(),(0,n.showContextMenu)(o.clientX,o.clientY,e.id,s,e.text))}},t.scrollChatToBottom=function(){const e=document.querySelector(".chat-messages");e&&(e.scrollTop=e.scrollHeight)},t.scrollChatToSeparator=function(){const e=document.querySelector(".chat-messages"),t=document.querySelector(".new-message-separator");e&&t&&t.scrollIntoView(!0)},t.editOptionHandler=function(e,t,s,n){return()=>{c(e,t,s),n.remove()}},t.putMessageTextToInput=c,t.deleteOptionHandler=function(e,t,s){return()=>{e.sendMessageDeleteNotification(t),s.remove()}},t.closeContextMenuOnMouseMoveHandler=l,t.closeContextMenuOnClick=d,t.removeMessageFromChat=function(e){const t=document.querySelector(".chat-messages");if(t){const s=[...t.children].find((t=>{if(t instanceof HTMLElement)return t.dataset.id===e}));s&&s.remove()}},t.updateMessageInChat=function(e){const t=document.querySelector(".chat-messages");if(t){const s=[...t.children].find((t=>{if(t instanceof HTMLElement)return t.dataset.id===e.id}));if(s){const t=s.querySelector(".message-text");t&&e.text&&(t.textContent=e.text);const n=s.querySelector(".message-edit-state");n&&e.status.isEdited&&(n.textContent="edited")}}},t.addCloseHandlersForContextMenu=function(e){const t=l(e);e.addEventListener("mouseout",t);const s=d(e);document.addEventListener("click",s)},t.updateUserStatusUsersList=function(e){const t=document.querySelector(".users");if(t){const s=[...t.children].find((t=>t.textContent===e.login));if(s){const t=s.querySelector(".user-status");t&&(e.isLogined?(t.classList.remove("user-status-inactive"),t.classList.add("user-status-active")):(t.classList.add("user-status-inactive"),t.classList.remove("user-status-active")))}}};const n=s(353),o=s(900),a=s(353),r=s(353);function i(e){const t=document.querySelector(".chat-header");if(t){const s=[...t.children];s[0].textContent===e.login&&(e.isLogined?(s[1].textContent="online",s[1].classList.add("selected-user-status-active"),s[1].classList.remove("selected-user-status-inactive")):(s[1].textContent="offline",s[1].classList.add("selected-user-status-inactive"),s[1].classList.remove("selected-user-status-active")))}}function c(e,t,s){var n,o;const a=document.querySelector(".chat-input"),r=document.createElement("button");if(null===(n=document.querySelector(".save-update"))||void 0===n||n.remove(),r.className="save-update",r.textContent="Save",null===(o=document.querySelector(".chat-message-container"))||void 0===o||o.append(r),a&&a instanceof HTMLTextAreaElement){a.value=t;const n=function(e,t,s){return n=>{s.sendMessageUpdateNotification(e,t.value),t.value="",n.target instanceof HTMLElement&&n.target.remove()}}(e,a,s);r.addEventListener("click",n)}}function l(e){return t=>{if(t.relatedTarget instanceof Element&&t.target instanceof Element){if(t.relatedTarget.closest(".chat-context-menu"))return;!t.relatedTarget.closest(".chat-context-menu")&&t.target.closest(".chat-context-menu")&&e.remove()}}}function d(e){return t=>{t.target instanceof Element&&!t.target.closest(".chat-context-menu")&&e.remove()}}},546:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderLoginContent=function(e,t,s){const o=document.querySelector(".wrapper");o&&(o.innerHTML="",o.append(function(e,t,s){const o=document.createElement("main");o.className="main",o.classList.add("main-login");const a=document.createElement("form");a.className="auth-form";const r=function(){const e=document.createElement("div");e.className="user-name-row";const t=document.createElement("label");t.className="user-name-label",t.textContent="User Name";const s=document.createElement("input");s.className="user-name-input";const o=document.createElement("p");if(o.className="user-name-error",s instanceof HTMLInputElement){s.required=!0,s.minLength=2,s.maxLength=10;const e=(0,n.userNameFieldHandler)(s,o);s.addEventListener("input",e)}return e.append(t,s,o),e}(),i=function(){const e=document.createElement("div");e.className="password-row";const t=document.createElement("label");t.className="password-label",t.textContent="Password";const s=document.createElement("input");s.className="password-input";const o=document.createElement("p");if(o.className="password-error",s instanceof HTMLInputElement){s.required=!0,s.minLength=6,s.maxLength=10,s.pattern="[a-zA-Z0-9]{6,10}";const e=(0,n.passwordFieldHandler)(s,o);s.addEventListener("input",e)}return e.append(t,s,o),e}(),c=document.createElement("button");c.className="login-button",c.textContent="Login";const l=(0,n.loginHandler)(e,t);c.addEventListener("click",l);const d=document.createElement("button");d.className="login-info-button",d.textContent="Info";const u=(0,n.infoButtonHandlerLogin)(s);return d.addEventListener("click",u),a.append(r,i,c,d),o.append(a),o}(e,t,s)));const a=document.querySelector(".user-name-input"),r=document.querySelector(".password-input");a instanceof HTMLInputElement&&r instanceof HTMLInputElement&&(!1===a.validity.valid||!1===r.validity.valid?(0,n.disableLoginButton)():(0,n.enableLoginButton)())};const n=s(282)},613:(e,t)=>{var s,n;Object.defineProperty(t,"__esModule",{value:!0}),t.ResponseTypesChat=t.ResponseTypesUsers=void 0,function(e){e.USER_LOGIN="USER_LOGIN",e.USER_LOGOUT="USER_LOGOUT",e.USER_EXTERNAL_LOGIN="USER_EXTERNAL_LOGIN",e.USER_EXTERNAL_LOGOUT="USER_EXTERNAL_LOGOUT",e.USER_ACTIVE="USER_ACTIVE",e.USER_INACTIVE="USER_INACTIVE",e.ERROR="ERROR"}(s||(t.ResponseTypesUsers=s={})),function(e){e.MSG_SEND="MSG_SEND",e.MSG_FROM_USER="MSG_FROM_USER",e.MSG_DELIVER="MSG_DELIVER",e.MSG_READ="MSG_READ",e.MSG_DELETE="MSG_DELETE",e.MSG_EDIT="MSG_EDIT"}(n||(t.ResponseTypesChat=n={}))},656:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Router=void 0;const n=s(546),o=s(900),a=s(353),r=s(439),i=s(469);t.Router=class{constructor(e,t){this.connection=e,this.currentUrl="",this.userService=new o.UserService(e,this,t),this.chatService=new i.ChatService(e,this,this.userService),this.routes=this.setRoutes(),globalThis.addEventListener("popstate",(()=>{this.openPage()}))}openPage(e){var t;void 0!==e&&history.pushState(null,"",e),this.currentUrl=globalThis.location.pathname.slice(1),""===this.currentUrl&&history.pushState(null,"","login"),null===(t=this.routes.find((e=>e.url===this.currentUrl)))||void 0===t||t.handler()}setRoutes(){return[{url:"login",handler:this.openLoginPage.bind(this)},{url:"chat",handler:this.openChatPage.bind(this)},{url:"info",handler:r.renderInfoContent},{url:"",handler:this.openLoginPage.bind(this)}]}openLoginPage(){this.userService.getAllActiveUsers(),this.userService.getAllInactiveUsers();const e=this.userService.users.find((e=>e.login===this.userService.currentUser.login));e&&e.isLogined?this.redirectToChat():(0,n.renderLoginContent)(this.connection,this.userService,this)}openChatPage(){this.userService.getAllActiveUsers(),this.userService.getAllInactiveUsers();const e=this.userService.users.find((e=>e.login===this.userService.currentUser.login));e&&e.isLogined?(0,a.renderChatPageContent)(this.userService,this.chatService,this):this.redirectToLogin()}redirectToChat(){(0,a.renderChatPageContent)(this.userService,this.chatService,this),history.replaceState(null,"","/chat")}redirectToLogin(){(0,n.renderLoginContent)(this.connection,this.userService,this),history.replaceState(null,"","/login")}}},695:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0;const n=s(722);t.State=class{constructor(){this.chatState=new n.SessionStorage("chat_state")}saveChatState(e){this.chatState.saveData(e)}getChatState(){return this.chatState.getData()}}},722:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SessionStorage=void 0,t.SessionStorage=class{constructor(e){this.key=e}saveData(e){sessionStorage.setItem(this.key,JSON.stringify(e))}getData(){const e=sessionStorage.getItem(this.key);return null===e?null:JSON.parse(e)}}},820:function(e,t,s){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createErrorMessage=function(e){const t=document.createElement("div");t.className="dark-view";const s=document.createElement("div");s.className="modal";const n=document.createElement("span");n.className="icon-close",n.addEventListener("click",a);const r=new Image;r.src=o.default;const i=document.createElement("p");i.textContent=e,i.className="modal-text",n.append(r),t.append(s),s.append(n,i),document.body.append(t),document.addEventListener("keydown",(e=>{"Escape"==e.code&&a()}))};const o=n(s(183));function a(){const e=document.querySelector(".dark-view");e&&e.remove()}},849:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0,t.Connection=class{constructor(){this.userIdRequest=null,this.url="ws://localhost:4000",this.connection=null,this.listeners={}}connect(){this.connection=new WebSocket(this.url),this.connection.addEventListener("open",(e=>{this.listeners.open.forEach((t=>t(e)))})),this.connection.addEventListener("close",(e=>{this.listeners.close.forEach((t=>t(e)))})),this.connection.addEventListener("message",(e=>{this.listeners.message.forEach((t=>t(e)))}))}addHandlerPerEvent(e,t){e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t]}}},900:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserService=void 0,t.prepareUserLogoutRequest=function(e){const t=e.currentUser.login,s=e.currentUser.password;let n="",o="";t&&s&&(n=t,o=s);return{id:crypto.randomUUID(),type:r.ResponseTypesUsers.USER_LOGOUT,payload:{user:{login:n,password:o}}}},t.prepareUserRequest=function(e,t){const s=document.querySelector(".user-name-input"),n=s instanceof HTMLInputElement?s.value:"",o=document.querySelector(".password-input"),a=o instanceof HTMLInputElement?o.value:"";e.userIdRequest=crypto.randomUUID();const i={id:e.userIdRequest,type:r.ResponseTypesUsers.USER_LOGIN,payload:{user:{login:n,password:a}}};return t.currentUser={login:n,password:a},i};const n=s(820),o=s(24),a=s(353),r=s(613),i=s(471);t.UserService=class{constructor(e,t,s){this.connection=e,this.router=t,this.currentUser={},this.state=s;const n=s.getChatState();if("object"==typeof n&&null!==n&&"currentUser"in n){const e=n.currentUser;"object"==typeof e&&null!==e&&(this.currentUser=e)}this.users=[],this.processUserMessages()}processUserMessages(){this.connection.addHandlerPerEvent("message",(e=>{if(e instanceof MessageEvent){const t=e.data;let s;"string"==typeof t&&(s=JSON.parse(t)),(0,o.isGeneralMessage)(s)&&(this.userLoginHandler(s),this.userLogoutHandler(s),this.activeUsersHandler(s),this.inactiveUsersHandler(s),this.externalLoginHandler(s),this.externalLogoutHandler(s),function(e){if(e.type===r.ResponseTypesUsers.ERROR&&(0,o.isErrorPayload)(e.payload)){const t=e.payload;(0,n.createErrorMessage)(t.error)}}(s))}}))}userLoginHandler(e){e.type===r.ResponseTypesUsers.USER_LOGIN&&(0,o.isUserPayloadServer)(e.payload)&&this.handleUserLoginMessage(e.payload)}userLogoutHandler(e){e.type===r.ResponseTypesUsers.USER_LOGOUT&&(0,o.isUserPayloadServer)(e.payload)&&this.handleUserLogoutMessage(e.payload)}activeUsersHandler(e){e.type===r.ResponseTypesUsers.USER_ACTIVE&&(0,o.isUsersPayloadServer)(e.payload)&&this.handleRegisteredUsersMessage(e.payload)}inactiveUsersHandler(e){e.type===r.ResponseTypesUsers.USER_INACTIVE&&(0,o.isUsersPayloadServer)(e.payload)&&this.handleRegisteredUsersMessage(e.payload)}externalLoginHandler(e){e.type===r.ResponseTypesUsers.USER_EXTERNAL_LOGIN&&(0,o.isUserPayloadServer)(e.payload)&&this.handleExternalLogin(e.payload)}externalLogoutHandler(e){e.type===r.ResponseTypesUsers.USER_EXTERNAL_LOGOUT&&(0,o.isUserPayloadServer)(e.payload)&&this.handleExternalLogout(e.payload)}handleUserLoginMessage(e){var t;e.user.login===(null===(t=this.currentUser)||void 0===t?void 0:t.login)&&e.user.isLogined&&(this.updateUsersListAfterLogin(e.user),"login"===globalThis.location.pathname.slice(1)&&this.router.openPage("chat"),this.state.saveChatState({currentUser:this.currentUser}))}updateUsersListAfterLogin(e){if(this.users.some((t=>t.login===e.login))){const t=this.users.findIndex((t=>t.login===e.login));this.users[t].isLogined=e.isLogined}else this.users.push(e)}updateUsersListAfterLogout(){if(this.users.some((e=>e.login===this.currentUser.login))){const e=this.users.findIndex((e=>e.login===this.currentUser.login));this.users.splice(e,1)}}handleUserLogoutMessage(e){var t;e.user.login!==(null===(t=this.currentUser)||void 0===t?void 0:t.login)||e.user.isLogined||(this.currentUser={},this.router.chatService.activeChatWith={},this.state.saveChatState({currentUser:this.currentUser}),this.updateUsersListAfterLogout(),this.router.openPage("login"))}handleRegisteredUsersMessage(e){e.users.forEach((e=>{this.updateUsersListAfterLogin(e)})),(0,a.drawUsers)(this.users.filter((e=>e.login!==this.currentUser.login)),this.router.chatService)}sendUserMessage(e){this.connection.connection&&this.connection.connection.send(JSON.stringify(e))}getAllActiveUsers(){const e={id:crypto.randomUUID(),type:r.ResponseTypesUsers.USER_ACTIVE,payload:null};this.connection.connection&&this.connection.connection.send(JSON.stringify(e))}getAllInactiveUsers(){const e={id:crypto.randomUUID(),type:r.ResponseTypesUsers.USER_INACTIVE,payload:null};this.connection.connection&&this.connection.connection.send(JSON.stringify(e))}handleExternalLogin(e){if(this.users.some((t=>t.login===e.user.login))){const t=this.users.find((t=>t.login===e.user.login));t&&(t.isLogined=!0),(0,i.updateUserStatusUsersList)(e.user),(0,i.updateUserStatusHeader)(e.user)}else this.users.push(e.user),(0,a.drawUser)(e.user)}handleExternalLogout(e){const t=this.users.find((t=>t.login===e.user.login));t&&(t.isLogined=!1),(0,i.updateUserStatusUsersList)(e.user),(0,i.updateUserStatusHeader)(e.user)}searchUsers(e){const t=this.users.filter((e=>e.login!==this.currentUser.login)).filter((t=>t.login.includes(e)));(0,a.drawUsers)(t,this.router.chatService)}}},938:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createBaseContainer=function(){const e=document.createElement("div");e.className="wrapper",document.body.append(e)}}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,s),a.exports}s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{const e=s(849);s(289);const t=s(938),n=s(695),o=s(656),a=s(820),r=s(613),i=new e.Connection;(0,t.createBaseContainer)();const c=new n.State,l=new o.Router(i,c);i.addHandlerPerEvent("open",(()=>{const e=document.querySelector(".reconnect-message");e&&e.remove();const t=l.userService.currentUser;l.userService.getAllActiveUsers(),l.userService.getAllInactiveUsers();const s=l.userService.users.find((e=>e.login===l.userService.currentUser.login));if(null==s?void 0:s.isLogined)l.openPage();else{if("login"in t&&t.login&&"password"in t&&t.password){const e={id:crypto.randomUUID(),type:r.ResponseTypesUsers.USER_LOGIN,payload:{user:{login:t.login,password:t.password}}};l.userService.sendUserMessage(e),l.openPage()}l.openPage()}})),i.addHandlerPerEvent("close",(()=>{var e,t;document.querySelector(".reconnect-message")?(l.userService.users=[],i.connect()):((0,a.createErrorMessage)("reconnecting..."),null===(e=document.querySelector(".icon-close"))||void 0===e||e.remove(),null===(t=document.querySelector(".dark-view"))||void 0===t||t.classList.add("reconnect-message"),i.connect())})),i.connect()})()})();
//# sourceMappingURL=bundle.f834cf974ee4e15a3270.js.map